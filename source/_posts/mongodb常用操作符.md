---
title: mongodbå¸¸ç”¨æ“ä½œç¬¦
date: 2020-10-18 16:13:52
tags: 
 - database
 - mongodb
banner_img: /images/mongodbå¸¸ç”¨æ“ä½œç¬¦/mongodb-cover-page.png
index_img: /images/mongodbå¸¸ç”¨æ“ä½œç¬¦/mongodb-cover-page.png  
categories:
  - æ•°æ®åº“  
  - mongodb
  - node
  - åç«¯  
---

## MongoDBæ“ä½œç¬¦

### MongoDBä»‹ç»
`MongoDB` æ˜¯ç”±`C++`è¯­è¨€ç¼–å†™çš„ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿã€‚  
åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯æœåŠ¡å™¨æ€§èƒ½ã€‚  
`MongoDB` æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚  
`MongoDB` å°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(`key=>value`)`å¯¹ç»„æˆã€‚MongoDB` æ–‡æ¡£ç±»ä¼¼äº `JSON` å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚ 
å¦‚ä¸‹è¿™ç§ç»“æ„
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/mongodb-cover-page.png" />

### MongoDBå‘½ä»¤è¡Œç®€å•æ“ä½œ

å‡è®¾å­˜åœ¨æ•°æ®åº“åç§°ä¸º`database`  
å¹¶ä¸”å­˜åœ¨ä¸€ä¸ªé›†åˆä¸º`collection`  
é›†ä¸­`collection`ä¸­æœ‰å¦‚ä¸‹æ•°æ®
```javascript
[
  {
    "name": "Daniel",
    "age": 24,
    "job": "it",
    "hobby": "travel"
  },
  {
    "name": "Mike",
    "age": 18,
    "job": "student",
    "hobby": "travel"
  }
]
```

- åˆ›å»ºæ•°æ®åº“æˆ–ä½¿ç”¨æ•°æ®åº“
`use database`

- åˆ é™¤æ•°æ®åº“
`db.dropDatabase()`

- æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨
`show dbs`

- åˆ›å»ºé›†åˆ
æ‰§è¡Œ`use`æ“ä½œå  
`db.collection.opertion`
æ²¡æœ‰åˆ›å»ºé›†åˆçš„è¯­æ³•ï¼Œç›´æ¥å¯¹æŒ‡å®šé›†åˆè¿›è¡Œæ“ä½œå°±ä¼šåˆ›å»ºè¯¥é›†åˆ  

- æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„é›†åˆåˆ—è¡¨
`show collections`

- åˆ é™¤é›†åˆ
`db.collection.drop()`

- æŸ¥æ‰¾
1. æ‰§è¡Œ`find`å‘½ä»¤
`db.collection.find({ hobby: "travel" })`
å¾—åˆ°ä»¥ä¸‹ç»“æœ
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/find-common.png"  />

`find`å‘½ä»¤ä¼šæ‰¾åˆ°ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ‰€æœ‰ç»“æœ  
å¯ä»¥åœ¨åé¢è·Ÿä¸Š`.pretty()`æ¥è®©æ•°æ®å±•ç¤ºæ›´ç¾è§‚ã€‚ 
åé¢è·Ÿ`.count()`è¿”å›æŸ¥æ‰¾åˆ°çš„æ•°é‡  
åé¢è·Ÿ`.sort()`è¿”å›æ’åºåçš„æ•°æ®  
æ¯”å¦‚è¿™æ ·`db.collection.find({ hobby: "travel" }).sort({ age: 1 })`ï¼Œ`1`è¡¨ç¤ºå‡åºï¼Œ`2`é™åº

2. æ‰§è¡Œ`findOne`å‘½ä»¤  
`db.collection.findOne({ hobby: "travel" })`  
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/findOne.png"  />
`findOne`åªä¼šæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡  

- åˆ é™¤
1. æ‰§è¡Œ`deleteOne`å‘½ä»¤  
`db.collection.deleteOne({ hobby: "travel" })`  
å¾—åˆ°ä»¥ä¸‹ç»“æœ
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/deleteOne.png"  />
`deleteOne`å‘½ä»¤ä¼šåˆ é™¤ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®

2. æ‰§è¡Œ`deleteMany`å‘½ä»¤  
`db.collection.deleteMany({ hobby: "travel" })`  
`deleteMany`å‘½ä»¤ä¼šåˆ é™¤ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ‰€æœ‰æ•°æ®

- æ’å…¥
1. æ‰§è¡Œ`insertOne`å‘½ä»¤  
`db.collection.insertOne({ "name": "Rick", "age": 32, "job": "teacher", "hobby": "sport" })`  
`insertOne`å‘½ä»¤å¯ä»¥æ·»åŠ ä¸€æ¡æ•°æ®åˆ°é›†åˆä¸­  
ä»–æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°`{ writeConcern }`ï¼Œå†™å…¥ç­–ç•¥ï¼Œé»˜è®¤ä¸º 1ï¼Œå³è¦æ±‚ç¡®è®¤å†™æ“ä½œï¼Œ0 æ˜¯ä¸è¦æ±‚ã€‚  
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/insertOne.png"  />

2. æ‰§è¡Œ`insertMany`å‘½ä»¤  
```javascript
db.collection.insertMany([
  {
    "name": "Jack",
    "age": 12,
    "job": "student",
    "hobby": "watch tv"
  },
  {
    "name": "Mary",
    "age": 8,
    "job": "student",
    "hobby": "book"
  }
])
```
`insertMany`å…è®¸åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®åˆ°é›†åˆä¸­  
ä»–æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°`{ writeConcern, ordered }`ï¼ŒwriteConcernæ„ä¹‰åŒä¸Šï¼Œorderdè¡¨ç¤ºæ˜¯å¦æŒ‰é¡ºåºå†™å…¥ï¼Œé»˜è®¤ trueï¼ŒæŒ‰é¡ºåºå†™å…¥ã€‚  

- æ›´æ–°
1. æ‰§è¡Œ`updateOne`å‘½ä»¤
`db.collection.updateOne({ "name": "Mike" }, { $set: { "age": 20 } })`
`updateOne`å‘½ä»¤å¯ä»¥æ›´æ–°åŒ¹é…æ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®
<img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/updateOne.png"  />

2. æ‰§è¡Œ`updateMany`å‘½ä»¤
`db.collection.updateMany({ "hobby": "travel" }, { "hobby": "watch tv" })`
`updateMany`å‘½ä»¤å¯ä»¥æ›´æ–°åŒ¹é…æ¡ä»¶çš„æ‰€æœ‰æ•°æ®

è¿˜æœ‰å‡ ä¸ªå¯é€‰å‚æ•°ï¼Œå¯è‡ªè¡Œç™¾åº¦

### MongoDBæ“ä½œç¬¦

æ¥ä¸‹æ¥ä»‹ç»çš„æ˜¯`MongoDB`ä¸­ä¸€äº›å¸¸ç”¨çš„æ“ä½œç¬¦ï¼Œæš‚æ—¶å°†æ“ä½œç¬¦åˆ†ä¸ºæ›´æ–°å’ŒæŸ¥æ‰¾ä¸¤ç±»ã€‚

#### æ›´æ–°æ“ä½œç¬¦  
 ##### $inc  
  å¯¹ä¸€ä¸ªå­—æ®µå¢åŠ æŒ‡å®šæ•°é‡ï¼Œä¸”å­—æ®µçš„å€¼ç±»å‹ä¸ºæ•°å­—  
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$inc": { age: 100 }
    })
  ```
  å½“ç„¶å¯ä»¥é€šè¿‡æŒ‡å®šæ•°å­—å€¼ä¸º`è´Ÿæ•°`å®ç°é€’å‡æ“ä½œã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$inc.png"  />

 ##### $set  
  è¿™æ˜¯ç›¸å½“å¸¸è§çš„æ“ä½œç¬¦ï¼Œè¡¨ç¤ºè®¾ç½®æŒ‡å®šçš„`key`
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$set": { age: 1000 }
    })
  ```
  ä¸Šè¿°å°†`name`ä¸º`Mike`çš„å­—æ®µçš„`age`å­—æ®µè®¾ç½®ä¸º`1000`  
  å¦‚æœ`key`ä¸å­˜åœ¨çš„è¯åˆ™åˆ›å»º  
  å½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªå€¼ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¿®æ”¹çš„å€¼ä¹‹å‰æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–ä¸€ä¸ªæ•°ç»„çš„è¯ä¼šæ•´ä¸ªè¦†ç›–æ‰è¯¥å€¼ã€‚å…·ä½“çš„ä¿®æ”¹æ–¹æ³•å¯ä»¥å‚ç…§ä¸‹æ–¹çš„å…·ä½“å®ä¾‹ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$set.png"  />

  ##### $unset  
  å°†æŸä¸€ä¸ªå­—æ®µåˆ é™¤  
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$unset": { "hobby": "" }
    })
  ```
  ä¸Šè¿°å°†`name`ä¸º`Mike`çš„å­—æ®µçš„`hobby`å­—æ®µåˆ é™¤ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥å­—æ®µåˆ™ä¸è¿›è¡Œæ“ä½œ  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$unset.png"  />

  ##### $push  
  å¯¹æŸä¸€å­—æ®µè¿›è¡Œå†…å®¹è¿½åŠ ï¼Œåªèƒ½å¯¹æ•°ç»„å­—æ®µè¿›è¡Œæ“ä½œ(å¦åˆ™ä¼šæŠ¥é”™)ï¼Œä¸å­˜åœ¨åˆ™ç›´æ¥è®¾ç½®ä¸º`ç©ºæ•°ç»„`å¹¶æ·»åŠ   
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$push": { "like": "book" }
    })
  ```
  ä¸Šè¿°å°†`name`ä¸º`Mike`çš„å­—æ®µçš„`like`å­—æ®µè®¾ç½®ä¸º`[ "book" ]`
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$push.png"  />

  ##### $pushAll  
  ç±»ä¼¼ä¸Šé¢çš„`$push`æ“ä½œç¬¦ï¼Œä½†æ˜¯æ¥æ”¶çš„å€¼æ—¶ä¸€ä¸ª`æ•°ç»„`ï¼Œè¡¨ç¤ºå¯åŒæ—¶è¿½åŠ å¤šä¸ªå€¼ï¼ŒåŒæ ·æ˜¯å¯¹æ•°ç»„å­—æ®µè¿›è¡Œæ“ä½œ  
  ```javascript
    db.collection.updateOne({
      "name": "Jack"
    }, {
      "$pushAll": { "like": [ "tv", "sport" ] }
    })
  ```
  ä¸Šè¿°ç´§æ¥å‰é¢çš„æ“ä½œï¼Œå‘`like`å­—æ®µä¸­ç»§ç»­è¿½åŠ äº†`tv`å’Œ`sport`  
  ä¸è¿‡ä¼¼ä¹åœ¨é«˜ç‰ˆæœ¬`mongodb`å·²ç»å–æ¶ˆäº†è¿™ä¸ªæ“ä½œç¬¦ï¼Œæœ‰å¾…è€ƒè¯ã€‚

  ##### $addToSet  
  ç±»ä¼¼ä¸Šé¢çš„`$pushAll`æ“ä½œç¬¦ï¼Œä¸åŒçš„æ˜¯ï¼Œå½“ä¸”ä»…å½“è¯¥å€¼åœ¨å­—æ®µä¸­`ä¸å­˜åœ¨`æ—¶æ·»åŠ ï¼Œç›¸å½“äºæ˜¯è‡ªåŠ¨åšäº†å»é‡ã€‚  
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$addToSet": { "like": [ "tv", "hamberger" ] }
    })
  ```
  ç»§ç»­ä¸Šé¢çš„`like`æ·»åŠ æ•°æ®ï¼Œå› ä¸ºä¸Šé¢æ·»åŠ è¿‡`tv`å­—æ®µï¼Œæ‰€ä»¥å†æ¬¡æ·»åŠ è¢«å¿½ç•¥  
  å½“ç„¶æ­¤æ“ä½œç¬¦æ·»åŠ çš„å€¼ä¸ä¸€å®šæ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥è¿™æ ·  
  `$addToSet: { "like": "hamberger" }`  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$addToSet.png"  />

  ##### $pop  
  ä¸`$pop`æ“ä½œç¬¦ç›¸åï¼Œè¡¨ç¤ºåˆ é™¤æŒ‡å®šå­—æ®µçš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå€¼ï¼ŒåŒæ ·åªèƒ½æ˜¯æ•°ç»„  
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$pop": { "like": 1 }
    })
  ```
  ä¸Šè¿°è¡¨ç¤ºåˆ é™¤`like`å­—æ®µçš„æœ€åä¸€ä¸ªå€¼ã€‚  
  `1`è¡¨ç¤ºæœ€åä¸€ä¸ªå€¼ï¼Œ`-1`è¡¨ç¤ºç¬¬ä¸€ä¸ªå€¼  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$pop.png"  />

  ##### $pull  
  è¡¨ç¤ºä»æŸä¸€å­—æ®µä¸­åˆ é™¤æŒ‡å®šçš„å€¼ï¼Œé’ˆå¯¹æ•°ç»„  
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$pull": { "like": "hamberger" }
    })
  ```
  ä¸Šè¿°å°†`name`ä¸º`Mike`çš„å­—æ®µçš„`like`æ•°ç»„ä¸­çš„`hamberger`å­—æ®µåˆ é™¤  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$pull.png"  />

  ##### $pullAll  
  ç±»ä¼¼`$pull`æ“ä½œç¬¦ï¼Œä¸åŒçš„æ˜¯å¯ä»¥åŒæ—¶åˆ é™¤å¤šä¸ªå€¼
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      "$pullAll": { "like": [ "hamberger", "book" ] }
    })
  ```
  ä¸Šè¿°åˆ é™¤äº†`name`ä¸º`Mike`å­—æ®µçš„`like`ä¸­çš„`hamberger`å’Œ`book`  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$pullAll.png"  />

  ##### $rename  
  è¿™ä¸ªæ“ä½œç¬¦è¡¨ç¤ºå¯¹ä¹‹å‰è®¾ç½®è¿‡çš„å­—æ®µè¿›è¡Œé‡å‘½åï¼Œè®¾ç½®çš„æ˜¯`key`
  ```javascript
    db.collection.updateOne({
      "name": "Mike"
    }, {
      $rename: { "like": "dislike" }
    })
  ```
  ä¸Šè¿°å°†`like`å­—æ®µä¿®æ”¹ä¸ºäº†`dislike`åç§°ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$rename.png"  />

#### æŸ¥æ‰¾æ“ä½œç¬¦  

  ä¸‹é¢ä»‹ç»çš„ï¼Œæ˜¯å¸¸ç”¨çš„æŸ¥è¯¢æ“ä½œç¬¦ğŸŒ°  

  ##### $all  
  æŸ¥æ‰¾å­—æ®µä¸­åŒ…å«æŒ‡å®šå†…å®¹çš„å€¼ï¼Œä¸”éœ€è¦åŒ…å«å…¨éƒ¨æŒ‡å®šçš„å€¼ï¼Œé’ˆå¯¹æ•°ç»„å‹å­—æ®µ  
  ```javascript
    db.collection.find({
      "like": { "$all": [ "hamberger", "book" ] }
    })
  ```
  ä¸Šè¿°èƒ½æŸ¥æ‰¾åˆ°`name`ä¸º`Mike`å­—æ®µï¼Œä½†æ˜¯æ— æ³•æŸ¥æ‰¾åˆ°å…¶ä»–å­—æ®µï¼Œå› ä¸ºä»–ä»¬æ— æ³•å®Œå…¨æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$all.png"  />

  ##### $gt  
  æŸ¥æ‰¾å¤§äº(great then)æŒ‡å®šå€¼çš„å­—æ®µ
  ```javascript
    db.collection.find({
      "age": { "$gt": 18 }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`age`å¤§äº`18`çš„å­—æ®µï¼Œä¸åŒ…å«`18`  
  `æ—¥æœŸ`ä¹Ÿå¯ç›´æ¥é‚£è¿™ä¸ªè¿›è¡Œæ¯”è¾ƒ  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$gt.png"  />

  ##### $gte  
  è¡¨ç¤ºä¸å°äºæŒ‡å®šå€¼ï¼Œä¹Ÿå°±æ˜¯å¤§äºç­‰äº  
  ```javascript
    db.collection.find({
      "age": { "$gte": 20 }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`age`ä¸å°äº`20`çš„å­—æ®µï¼Œæ‰€ä»¥åŒ…æ‹¬ç­‰äº`20`çš„å­—æ®µ  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$gte.png"  />

  ##### $lt  
  ä¸ä¸Šé¢çš„`$gt`æ“ä½œç¬¦ç›¸åï¼Œè¡¨ç¤ºå°äº(less then)æŒ‡å®šå€¼  
  ```javascript
    db.collection.find({
      "age": { "$lt": 20 }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`age`å°äº`20`çš„å­—æ®µï¼Œä¸”ä¸åŒ…å«`20`  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$lt.png"  />

  ##### $lte  
  è¡¨ç¤ºä¸å¤§äºæŒ‡å®šå€¼ï¼Œä¹Ÿå°±æ˜¯å°äºç­‰äº  
  ```javascript
    db.collection.find({
      "name": { "$lte": 18 }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`age`å°äº`18`çš„å­—æ®µï¼Œä¸”åŒ…å«`18`  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$lte.png"  />

  ##### $in  
  æŸ¥æ‰¾å­˜åœ¨æŒ‡å®šæ•°ç»„ä¸­å€¼å¾—é¡¹ï¼Œä¸`$all`ä¸åŒçš„æ˜¯ï¼Œå­—æ®µåªéœ€è¦æ»¡è¶³å…¶ä¸­ä»»æ„ä¸€é¡¹å³å¯  
  ```javascript
    db.collection.find({
      "age": { "$in": [ 18, 20 ] }
    })
  ```
  ä¸Šè¿°å¯ä»¥æ‰¾åˆ°æ‰€æœ‰åœ¨`age`å­—æ®µç­‰äº`18`æˆ–`20`çš„æ•°æ®  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$in.png"  />

  ##### $nin  
  ä¸ä¸Šé¢çš„`$in`æ“ä½œç¬¦ç›¸åï¼Œè¡¨ç¤ºæŸ¥æ‰¾ä¸å­˜åœ¨æŒ‡å®šæ•°ç»„ä¸­çš„å€¼çš„é¡¹
  ```javascript
    db.collection.find({
      "like": { "$nin": [ "tv" ] }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`like`å­—æ®µä¸­ä¸å­˜åœ¨`tv`çš„é¡¹  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$nin.png"  />

  ##### $ne  
  æœ‰ç›¸ç­‰å°±ä¼šæœ‰ä¸ç›¸ç­‰ï¼Œè¿™ä¸ªæ“ä½œç¬¦å°±æ˜¯æŸ¥æ‰¾ä¸ç­‰äºæŒ‡å®šå€¼å¾—é¡¹ï¼Œç›¸å½“äºåªæœ‰ä¸€é¡¹çš„`$nin`
  ```javascript
    db.collection.find({
      "like": { "$ne": "book" }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`like`å­—æ®µä¸­ä¸å­˜åœ¨`book`çš„é¡¹  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$ne.png"  />

  ##### $and  
  æŸ¥æ‰¾åŒæ—¶æ»¡è¶³æ‰€æœ‰æŒ‡å®šæ¡ä»¶çš„é¡¹ï¼Œå¹¶ä¸”è‡³å°‘éœ€è¦åŒ…å«**ä¸¤ä¸ª**æ¡ä»¶
  ```javascript
    db.collection.find({
      "$and": [
        {
          "name": "Mike"
        },
        {
          "age": 18
        }
      ]
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`name`ä¸º`Mike`å¹¶ä¸”`age`ä¸º`20`çš„å­—æ®µ  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$and.png"  />

  ##### $nor  
  ä¸ä¸Šé¢çš„`$and`ç›¸åï¼Œè¡¨ç¤ºæŸ¥æ‰¾åŒæ—¶ä¸æ»¡è¶³æ‰€æœ‰æŒ‡å®šæ¡ä»¶çš„é¡¹ï¼ŒåŒæ ·è‡³å°‘éœ€è¦åŒ…å«**ä¸¤ä¸ª**æ¡ä»¶  
  ```javascript
    db.collection.find({
      "$nor": [
        {
          "name": "Mike"
        },
        {
          "age": 18
        }
      ]
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`name`ä¸ä¸º`Mike`å¹¶ä¸”`age`ä¸ç­‰äº`18`çš„æ•°æ®  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$nor.png"  />

  ##### $not  
  æŒ‡å®šä¸èƒ½æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ•°æ®é¡¹ï¼Œæ­¤æ“ä½œç¬¦åªèƒ½åŒ…å«**ä¸€ä¸ª**æ¡ä»¶ï¼Œè€Œä¸”å®ƒæ— æ³•å•ç‹¬å®ŒæˆæŸ¥è¯¢ï¼Œéœ€è¦ä¸å…¶ä»–æ“ä½œç¬¦é…åˆä¸€èµ·ä½¿ç”¨ã€‚  
  ```javascript
    db.collection.find({
      "age": {
        "$not": { "$gt": 18 }
      }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`age`å­—æ®µå°äºç­‰äº`18`çš„æ•°æ®é¡¹ï¼Œå½“ç„¶åƒä¾‹å­è¿™æ ·çš„æƒ…å†µä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨`$lte`æ“ä½œç¬¦å®Œæˆã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$not.png"  />

  ##### $or  
  è¡¨ç¤ºæŸ¥æ‰¾èƒ½è‡³å°‘æ»¡è¶³**ä¸€ä¸ª**æ¡ä»¶çš„é¡¹ï¼Œå¹¶ä¸”éœ€è¦è‡³å°‘åŒ…å«**ä¸¤ä¸ª**ç­›é€‰æ¡ä»¶  
  ```javascript
    db.collection.find({
      "$or": [
        {
          "name": "Mike"
        },
        {
          "age": 20
        }
      ]
    })
  ```
  ä¸Šè¿°è¡¨ç¤ºæŸ¥æ‰¾`name`ä¸º`Mike`æˆ–è€…`age`ä¸º`20`çš„æ•°æ®é¡¹  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$or.png"  />

  ##### $exists  
  æ­¤æ“ä½œç¬¦ç”¨äºå­—æ®µçš„`key`çš„åˆ¤æ–­ï¼Œè¡¨ç¤ºæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¦å­—æ®µ`key`çš„æ•°æ®é¡¹ï¼Œå¯é€‰å€¼ä¸º`true`å’Œ`false`ï¼Œé€‰æ‹©**true**è¡¨ç¤ºå­˜åœ¨ï¼Œ**false**åˆ™ä¸å­˜åœ¨æŒ‡å®šå­—æ®µçš„é¡¹  
  ```javascript
    db.collection.find({
      "name": { "$exists": true }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾å­˜åœ¨`name`å­—æ®µçš„æ•°æ®é¡¹  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$exists.png"  />

  ##### $mod  
  è¡¨ç¤ºæŸ¥æ‰¾æ»¡è¶³è®¡ç®—ç»“æœçš„æ•°æ®é¡¹ï¼Œæ­¤æ“ä½œç¬¦ä¸ºå–æ¨¡  
  ```javascript
    db.collection.find({
      "age": { "$mod": [ 3, 0 ] }
    })
  ```
  ä¸Šè¿°è¡¨ç¤º`age`å­—æ®µçš„å€¼å¯¹3å–æ¨¡ç­‰äº0çš„å€¼ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$mod.png"  />

  ##### $type  
  è¡¨ç¤ºé€‰æ‹©æŒ‡å®šæ•°æ®ç±»å‹çš„æ•°æ®é¡¹  
  ```javascript
    db.collection.find({
      "name": { "$type": "string" }
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`name`å­—æ®µå€¼ç±»å‹ä¸º`string`çš„æ•°æ®é¡¹
  æ­¤æ“ä½œç¬¦è¡¨ç¤ºèƒ½æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ç±»å‹çš„æ•°æ®é¡¹ï¼Œå®ƒä¹Ÿæœ‰å¯¹åº”çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º
  > Double: 1
  String
  Object	3	 
  Array	4	 
  Binary data	5	 
  Undefined	6	å·²åºŸå¼ƒã€‚
  Object id	7	 
  Boolean	8	 
  Date	9	 
  Null	10	 
  Regular Expression	11	 
  JavaScript	13	 
  Symbol	14	 
  JavaScript (with scope)	15	 
  32-bit integer	16	 
  Timestamp	17	 
  64-bit integer	18	 
  Min key	255	Query with -1.
  Max key	127	 
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$type.png"  />

  ##### $regex  
  å°±æ˜¯å­—é¢æ„æ€ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å­—æ®µ
  ```javascript
    db.collection.find({
      "name": { "$regex": /mike/, "$options": "i" }
    })
  ```
  ä¸Šè¿°åŒ¹é…`name`å­—æ®µå€¼åŒ…å«`mike`ï¼ˆä¸åŒºåˆ†å¤§å°å†™æ˜¯å› ä¸ºé…ç½®äº†`$options`ï¼‰çš„æ•°æ®é¡¹  
  `$options`è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œå…¶ä»–çš„è¿˜æœ‰`i`(ä¸åŒºåˆ†å¤§å°å†™),`g`(å…¨å±€åŒ¹é…),`m`(å¤šè¡ŒåŒ¹é…),`s`(.åŒ…å«æ¢è¡Œç¬¦`\n`)  
  å½“ç„¶ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$regex.png"  />

  ##### $where  
  æœ‰äº›æƒ…å†µä¸‹æ™®é€šæ–¹æ³•å¾ˆéš¾åšå‡ºç­›é€‰ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ“ä½œç¬¦ç”¨`javascript`è¯­æ³•æ¥è¿›è¡Œç­›é€‰  
  ```javascript
    db.collection.find({
      "$where": "this.name='Jack'&&this.like.some(key => key == 'hamberger')"
    })
  ```
  ä¸Šè¿°æŸ¥æ‰¾`name`ä¸º`Jack`ä¸”`like`å­—æ®µåŒ…å«`hamberger`å€¼å¾—æ•°æ®é¡¹  
  å®ƒç”šè‡³å¯ä»¥ç›´æ¥å†™ä¸€ä¸ªå‡½æ•°`{ function() { return this.name == 'Jack' && this.like.some(key => key == 'hamberger') } }`  
  **æ³¨æ„**  
  è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆçš„è§£å†³ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯å°½é‡ä¸è¦ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦ï¼Œå› ä¸ºå®ƒä¼šå°†MongoDBé‡Œé¢ä¿å­˜çš„BSONæ•°æ®å˜ä¸ºJavaScriptçš„è¯­æ³•ç»“æ„ï¼Œè¿™æ ·çš„æ–¹å¼ä¸æ–¹ä¾¿ä½¿ç”¨æ•°æ®åº“çš„ç´¢å¼•æœºåˆ¶ã€‚  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$where.png"  />

  ##### $elemMatch  
  æ­¤æ“ä½œç¬¦ç”¨äºå¯¹ç±»ä¼¼ä¸€ä¸ªåµŒå¥—æ•°ç»„å¯¹è±¡æ¥è¿›è¡Œå¤šæ¡ä»¶çš„æŸ¥è¯¢  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$elemMatch.png"  />
  ä¸Šè¿°æŸ¥æ‰¾äº†`like`å­—æ®µæ•°ç»„ä¸­`type`ä¸º`eat`å¹¶ä¸”`target`ä¸º`hamberger`çš„æ•°æ®é¡¹  

  ##### $slice  
  å°†æ•°æ®ä¸­çš„æ•°ç»„å­—æ®µåšåˆ‡å‰²ï¼Œé€‰å‡ºä¸€æ®µé€‰åŒº  
  ```javascript 
    // åŸºæœ¬æŸ¥è¯¢
    db.collection.find({}, {
      like: {
        $slice: [1, 1]
      }
    })
    //èšåˆæŸ¥è¯¢
    db.collection.aggregate([
      {
        $project: {
          like: {
            $slice: [ "$like", 1, 1 ]
          }
        }
      }
    ])
  ```
  ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½èƒ½å–å‡ºå¯¹åº”çš„æ•°ç»„é¡¹çš„ç¬¬ä¸€æ¡ï¼Œä¸¤ä¸ªæ•°å­—åˆ†åˆ«ä»£è¡¨ï¼šèµ·å§‹çš„ç´¢å¼•ã€åˆ‡å‰²çš„æ•°é‡  
  - åŸºæœ¬æŸ¥è¯¢
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$slice-normal.jpg"  />  
  - èšåˆæŸ¥è¯¢  
  <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/$slice-aggregate.jpg" />

### ç›¸å…³å®ä¾‹

è®²å®Œäº†æ“ä½œç¬¦ï¼Œè¿™é‡Œç®€å•è®²å‡ ä¸ªä¹‹å‰åœ¨å®è·µå½“ä¸­ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä»¥åŠè§£å†³æ–¹æ³•ï¼Œæ¬¢è¿å„ä½å‚è€ƒã€‚  

  ##### æŸ¥æ‰¾æˆ–ä¿®æ”¹æ•°ç»„ä¸­åµŒå¥—çš„å¯¹è±¡çš„å±æ€§  
å‡è®¾`database`çš„`collection`ä¸­å­˜åœ¨ä»¥ä¸‹æ•°æ®  
```javascript
[
  {
    "name": "Mike",
    "age": 18,
    "job": "student",
    "like": [
      {
        "type": "eat",
        "target": "hamberger"
      },
      {
        "type": "sport",
        "target": "running"
      }
    ]
  },
  {
    "name": "Jack",
    "age": 50,
    "job": "teacher",
    "like": [
      {
        "type": "eat",
        "target": "vegetable"
      },
      {
        "type": "sport",
        "target": "baseball"
      }
    ]
  }
]
```
æ™®é€šæƒ…å†µä¸‹æ— æ³•ç›´æ¥é€‰ä¸­å¯¹åº”æ•°ç»„å¯¹è±¡çš„å±æ€§ï¼Œä½†æ˜¯`mongodb`ä¸­æ”¯æŒ`.`æ¥é€‰æ‹©æ•°ç»„å¯¹è±¡ä¸­çš„å±æ€§  
- `parent_field.child_field` 
æ¯”å¦‚åƒä¸Šé¢çš„`like`å­—æ®µé€‰æ‹©`target=vegetable`  
`db.collection.find({ "like.target": "vegetable" })`
 <img src="/images/mongodbå¸¸ç”¨æ“ä½œç¬¦/æ•°ç»„å¯¹è±¡åµŒå¥—æŸ¥è¯¢.png"  />

  ##### ä¿®æ”¹å¤šå±‚åµŒå¥—çš„æ•°ç»„å¯¹è±¡  
æœ‰æ—¶å€™ä¸æ­¢ä¼šæœ‰ä¸€å±‚åµŒå¥—ï¼Œå¤šå±‚åµŒå¥—ä¸Šé¢çš„æ–¹æ³•ä¸é€‚ç”¨ï¼Œè™½ç„¶è¿™ç§å­˜å‚¨æ–¹å¼ä¸å¤ªå¸¸è§ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è§£å†³  
å‡è®¾æœ‰å¦‚ä¸‹çš„æ•°æ®
```javascript
[
  {
    "name": "Jack",
    "like": [
      {
        type: "eat",
        target: [
          {
            name: "hamberger",
            price: 100
          },
          { 
            name: "salad",
            price: 200
          }
        ]
      }
    ]
  }
]

//æ‰§è¡Œæ›´æ–°æ“ä½œ
db.collection.updateOne({ name: "Jack" }, { $set: { "like.$[stepone].target.$[steptwo].price" : 200 } }, {
 arrayFilters: [
  {
   "stepone": {
    "$type": "object"
   },
   "stepone.type": "eat" 
  },
  {
   "steptwo": {
    "$type": "object"
   }
  }
 ]
})
```
ä¸Šè¿°æ“ä½œæ˜¯é€‰æ‹©ä¸Šé¢æ•°æ®ä¸­`like`å­—æ®µçš„`type`ä¸º`eat`å¹¶ä¸”`target`æ•°ç»„ä¸­çš„`name`ä¸º`hamberger`çš„ä»·æ ¼`price`æ”¹æˆäº†200  
`updateOne`çš„ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨æˆ·å®šä¹‰ç¬¬äºŒå‚æ•°ä¸­ç”¨åˆ°çš„åµŒå¥—åç§°çš„ç­›é€‰æ¡ä»¶ï¼Œå¹¶ä¸”å®ƒçš„åç§°å®šä¹‰ä¸º**ä»¥å°å†™å­—æ¯å¼€å¤´çš„å­—æ¯æ•°å­—å­—ç¬¦ä¸²**  

### ç»“æŸ
`MongoDB`çš„æ“ä½œç¬¦ä»¥åŠå‘½ä»¤è¿œä¸æ­¢è¿™äº›ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œå»MongoDBå®˜ç½‘æŸ¥æ‰¾å­¦ä¹ ï¼Œæœ¬äººä¹Ÿä¼šåœ¨åç»­çš„å®è·µå­¦ä¹ ä¸­ç»§ç»­æ›´æ–°ã€‚ğŸ˜¸
