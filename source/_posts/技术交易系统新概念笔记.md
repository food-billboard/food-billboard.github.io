---
title: 技术交易系统新概念笔记
date: 2022-11-28 09:13:00
tags: trade finance 
banner_img: /images/技术交易系统新概念笔记/background.jpeg
index_img: /images/技术交易系统新概念笔记/background.jpeg
categories: 
  - 交易
---

# 技术交易系统新概念笔记  

## 介绍  
  本文是本人在阅读了《技术交易系统新概念》所作的笔记。  

## 开始  

### 目录 

  记录一下目录：  
> 
  第一章 基本概念  
  第二章 抛物式时间/价格交易系统  
  第三章 波动交易系统  
  第四章 动向指标  
  第五章 动量概念-趋势平衡点交易系统  
  第六章 相对强弱指数  
  第七章 趋势-回调交易系统  
  第八章 摆动指标-短线交易系统  
  第九章 期货品种选择指标CSI  
  第十章 资金管理  

### 基本概念  

这里用到的一些概念会贯穿所有章节使用，需要提前记好。  

#### LOP | HIP  

- LOP  
其相邻的两根K线的最低价都高于其最低价  
- HIP  
其相邻的两根K先的最高价均低于其最高价  

<img src="/images/技术交易系统新概念笔记/LOP-HIP.png" />

#### SIP(HI SIP | LO SIP)  

简单来说应该就是最高和最低价格的意思吧。  

<img src="/images/技术交易系统新概念笔记/SIP.png" />

#### SIC   

表示交易中最有利的**收盘价**。  
多头表示最高价。  
空头表示最低价。  

#### SAR  

停止反转点，表示停止现有头寸，反方向操作。  

### 抛物式时间/价格交易系统  

  个人认为：  
  非常偏向数学方法的趋势跟踪系统。  
  只要记住他的计算功能，就非常容易完成整个系统。  
  马上就可以尝试使用代码完成系统。  

  记住几个关键的参数：  
  - AF  
    加速因子[0.02-0.2]  
    当日创下价格新高则`AF+0.02`(多头为新高，空头为新低)    
  - SAR  
    停止反转点  
  - SIP  
    价格极值  
  - EP  
    此次交易开始的最极值（多头为最高，空头为最低）。       

  `明日SAR = 今日SAR + AF(今日最高价 - 今日SAR)`  

#### 规则  
  - 入市时机  
    价格突破`SAR`  
  - 建仓第一天  
    SAR = 前一次交易SIP  
  - 第一天之后  
    多头：`明日SAR = 今日SAR + AF(最高价 - 今日SAR)`  
    空头：`明日SAR = 今日SAR - AF(最低价 - 今日SAR)`  
  - SAR不允许出现在前一日或今日价格区域  
    多头：明日SAR不能大于昨日或今日最低价，大于则`明日SAR = min(今日最低价，明日最低价)`  
    空头：明日SAR不能小于昨日或今日最高价，小于则`明日SAR = max(今日最高价，明日最高价)`  

```typescript
  let DATASOURCE: {
    state: 1 | -1 // 1 多头 -1 空头
    dailyData: { // 每日的交易数据
      date: string // 日期
      open: number // 开盘价
      high: number // 最高价
      low: number // 最低价
      close: number // 收盘价
      SAR: number 
      EP: number // 此次交易的极值
      EP_SAR: number // EP+-SAR 当前最高价和今日SAR 的差值
      AF: number // 加速因子
      AF_DIFF: number // EP_SAR * AF  
    }[]
  } = []

  // 模拟交易
  // 用于下面的首次入市前的准备工作
  let MOCK_DATASOURCE = []

  // 获取指定时间间隔的历史数据
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // 之前从未做过交易
  // 需要先找出前几周前的 最高|最低 点  
  // 基于是上升还是下跌趋势  
  // 当前设置为3周前  
  function getBeforeWeekPeak() {

    // 获取3周的时间间隔
    let startDate
    let endDate 

    // 第一天启用程序
    if(!MOCK_DATASOURCE.length) {
      const historyData = getHistoryData()
      // TODO 
      // 判断前几周的趋势
      
      let peakData 
      let peakIndex 
      // 如果是上升
      if(true) {
        // 找出前三周的最高点
        historyData.forEach((history, index) => {
          if(!peakData || history.high > peakData.high) {
            peakData = history 
            peakIndex = index 
          }
        })
        // 找出最高点后4天的最低点
        // 作为入市点
        const enterDate = historyData.slice(peakIndex, peakIndex + 4)
        const SAR = peakData.high
        const EP = enterDate.low
        const EP_SAR = Math.abs(SAR - EP)
        MOCK_DATASOURCE.push({
          state: -1,
          dailyData: [
            date: enterDate.date,
            open: enterDate.open,
            high: enterDate.high,
            low: enterDate.low,
            close: enterDate.close,
            SAR, 
            EP,
            EP_SAR,
            AF: 0.02,
            AF_DIFF: EP_SAR * 0.02
          ]
        })
      }
      // 下跌
      else {
        // 找出前三周的最低点
        historyData.forEach((history, index) => {
          if(!peakData || history.low < peakData.low) {
            peakData = history 
            peakIndex = index 
          }
        })
        // 找出最低点后4天的最高点
        // 作为入市点
        const enterDate = historyData.slice(peakIndex, peakIndex + 4)

        const SAR = peakData.low
        const EP = enterDate.high
        const EP_SAR = Math.abs(SAR - EP)
        MOCK_DATASOURCE.push({
          state: 1,
          dailyData: [
            date: enterDate.date,
            open: enterDate.open,
            high: enterDate.high,
            low: enterDate.low,
            close: enterDate.close,
            SAR, 
            EP,
            EP_SAR,
            AF: 0.02,
            AF_DIFF: EP_SAR * 0.02
          ]
        })
      }
    }

    // TODO 
    // 持续进行模拟记录数据
    // 但是这里有一点还没有弄清楚
    // 先暂时卡着吧

  }

  // 每日需要执行的函数
  function dailyFunction(options={
    mock: false,
    date: null 
  }) {

    const { mock, date } = options 
    const _DATASOURCE = mock ? MOCK_DATASOURCE : DATASOURCE

    // 初始化今日数据
    const todayData = getHistoryData(date, date)
    const newDailyData = {
      ...todayData,
    }

    // 之前未做过交易
    // 可以选择以下方法
    // 也可以选择使用后面说到的第四章的方法（动向指数）
    if(!_DATASOURCE.length) {
      return getBeforeWeekPeak()
    }

    // 是否今日开启交易
    const lastTradeNote = _DATASOURCE[_DATASOURCE.length - 2]
    const currentTradeNote = _DATASOURCE[_DATASOURCE.length - 1]
    const { dailyData, state } = currentTradeNote

    // 第一天
    if(!dailyData.length) {
      // 之前存在交易
      if(!!lastTradeNote && Array.isArray(lastTradeNote.dailyData) && lastTradeNote.dailyData.length) {
        const { dailyData, state } = lastTradeNote
        // 多头则获取前一次交易的最低价
        // 空头则获取前一次交易的最高价
        // 这里只需要取前一次交易的最后一天的极值EP即可
        newDailyData.SAR = dailyData[dailyData.length - 1].EP
        newDailyData.EP = state === 1 ? newDailyData.high : newDailyData.low
      }
    }
    // 非第一天
    else {
      // 前一天的数据
      const yestodayData = dailyData[dailyData.length - 1]
      const beforeYestodayData = dailyData[dailyData.length - 2] || {
        low: 999999,
        high: -1
      }
      
      if(state === 1) {
        newDailyData.SAR = yestodayData.SAR + yestodayData.AF_DIFF
        // 多头 SAR 不得大于前一日或今日最低价，大于则选择当日或昨日最低价
        const lessThenPrize = Math.min(yestodayData.low, beforeYestodayData.low)
        newDailyData.SAR = newDailyData.SAR === Math.min(lessThenPrize, newDailyData.SAR) ? newDailyData.SAR : lessThenPrize

        newDailyData.EP = Math.max(yestodayData.EP, newDailyData.high)
      }else {
        newDailyData.SAR = yestodayData.SAR - yestodayData.AF_DIFF
        // 空头 SAR 不得小于前一日或今日最高价，小于则选择党日或昨日最高价
        const greatThenPrize = Math.max(yestodayData.high, beforeYestodayData.high)
        newDailyData.SAR = newDailyData.SAR === Math.max(lessThenPrize, newDailyData.SAR) ? newDailyData.SAR : lessThenPrize

        newDailyData.EP = Math.min(yestodayData.EP, newDailyData.low)
      }
    }

    // 获取 EP 和 SAR 的差值
    newDailyData.EP_SAR = Math.abs(newDailyData.SAR - newDailyData.EP)
    newDailyData.AF = newDailyData.AF || 0.02 
    // 创新高或新低则增加AF值
    if(state === 1) {
      newDailyData.AF += newDailyData.high > newDailyData.EP ? 0.02 : 0
    }else {
      newDailyData.AF += newDailyData.low < newDailyData.EP ? 0.02 : 0
    }
    newDailyData.AF = Math.min(0.2, newDailyData.AF)
    newDailyData.AF_DIFF = newDailyData.AF * newDailyData.EP_SAR

    // 多头发生价格突破
    const isMultiBreak = state === 1 && newDailyData.low < newDailyData.SAR
    // 空头发生价格突破
    const isEmptyBreak = state === -1 && newDailyData.high > newDailyData.SAR

    if(isMultiBreak || isEmptyBreak) {
      newDailyData.AF = 0.02 
      newDailyData.SAR = newDailyData.EP 
      newDailyData.EP = state === 1 ? newDailyData.low : newDailyData.high 
      newDailyData.EP_SAR = Math.abs(newDailyData.SAR - newDailyData.EP)
      newDailyData.AF_DIFF = newDailyData.EP_SAR * newDailyData.AF

      console.log((state === 1 ? '多头' : '空头') + '价格发生突破')

      _DATASOURCE.push({
        state: -1,
        dailyData: [
          {
            ...newDailyData,
          }
        ]
      })
    }
    // 记录今日数据
    else {
      console.log('今日价格数据:' + JSON.stringify(newDailyData))
      _DATASOURCE[_DATASOURCE.length - 1].dailyData.push(newDailyData)
    }

  }

  // 数据清空
  function clearData() {
    DATASOURCE = {
      state: 1,
      dailyData: []
    }
    MOCK_DATASOURCE = {
      state: 1,
      dailyData: []
    }
  }


```

### 波动交易系统  

也是一个趋势跟踪的系统。  
根据市场的波动性来作出相应的操作。  

- `ATR`计算  
<img src="/images/技术交易系统新概念笔记/波动交易系统-ATR.jpg" />  

`ATR_t`是当日平均真实价格范围，`ATR_p`是前一日的平均真实价格范围。  
`TR`是当日真实价格范围。  

上述计算是根据七个交易日为标的做的计算。  
`ATR_p`即将加上今日以及前6个交易日的真实价格范围相加，并除7得出的，之后每一日的计算只要简单得将**前一日的平均真实价格范围**带入上述公式即可。  

- ARC 
  `ARC = ATR * C`  
  C是一个[2.8, 3.1]之间的常数（一般为3）。  

- 系统交易规则  

  计算出七天的`ARC`，找出七天最高收盘价`SIC`，`SAR = SIC - ARC`  
  若第二日的收盘价低于`SAR`，平仓建立空头。  
  

#### 真实价格范围  

  取以下三种的最大值。  
  1. 当日最高价到当日最低价的范围。  
  2. 昨日收盘价到当日最高价的范围。  
  3. 昨日收盘价到当日最低价的范围。  

#### 代码实现  
```typescript 

  // 常数C 
  const C = 3 // [2.8, 3]

  const DATA_SOURCE: {
    state: 1 | -1 // 当前是空头(-1)还是多头(1)
    TR: number // 当日的真实价格范围
    ATR: number // 当日的平均真实价格范围
    ARC: number // ATR * C
    SAR: number // 停止反转点  
    SIC: number // 最低收盘价
    high: number 
    close: number 
    low: number 
    open: number 
    date: string 
  } = []

  // 获取指定时间间隔的历史数据
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // 获取真实价格范围
  function getTR(currentData, yestodayData) {
    const abs = Math.abs
    return Math.max(abs(currentData.high - currentData.low), abs(currentData.high - yestodayData.close), abs(currentData.low - yestodayData.close))
  }

  // 每日定时执行方法
  function dailyFunction() {

    const currentDateData = getHistoryData()

    // 之前未做过任何交易
    if(DATA_SOURCE.length < 7) {
      // 简单从空头位置开始准备进入市场
      if(DATA_SOURCE.length < 6) {
        DATA_SOURCE.push({
          ...currentDateData,
          TR: getTR()
        })
      }else {
        const TR = getTR()
        const ATR = DATA_SOURCE.map(item => item.TR).reduce((acc, cur) => acc + cur, 0) / 7
        DATA_SOURCE.push({
          ...currentDateData,
          TR,
          ATR,
          ARC: ATR * C
        })
      }
    }

    const [lastDayData] = DATA_SOURCE.slice(-1)

    const todayTR = getTR(currentDateData, lastDayData)
    const todayATR = (6 * lastDayData.ATR + todayTR) / 7
    const ARC = todayATR * C
    let SIC 
    let SAR 
    let state 
    // 空头
    if(lastDayData.state == -1) {
      SIC = Math.min(lastDayData.SIC, currentDateData.close)
      SAR = lastDayData.SIC + lastDayData.ARC
      // 收盘价上穿SAR 变为多头
      state = currentDateData.close > SAR ? 1 : -1
      // 变为多头更改SIC为当日收盘价
      if(state === 1) {
        SIC = currentDateData.close
      }
    }
    // 多头
    else {
      SIC = Math.max(lastDayData.SIC, currentDateData.close)
      SAR = lastDayData.SIC - lastDayData.ARC
      // 收盘价下穿SAR 变为空头
      state = currentDateData.close < SAR ? -1 : 1
      // 变为空头更改SIC为当日收盘价
      if(state === 1) {
        SIC = currentDateData.close
      }
    }

    const newData = {
      ...currentDateData,
      TR: todayTR,
      ATR: todayATR,
      ARC,
      SIC,
      SAR,
      state
    }

    // 上面state改变则触发交易操作
    DATA_SOURCE.push(newData)

  }

```

### 动向指标  

根据一个`0-100`的指标来跟踪产品趋势。  

#### 几个指标概念  

##### +DM和-DM  
今日的价格范围与昨日价格返回的差值  
比如：昨天的价格范围是`[100 200]`，今日的价格范围是`[150, 300]`，则使用`+DM`表示为`300 - 200 = 100`  
<img src="/images/技术交易系统新概念笔记/动向指标-DM.jpg" />

当今日与昨日是**包含**关系时，DM为`0`。  
`+DM`和`-DM`始终是**正数**。  

> 计算规则  
1. 当日最高价与当日最低价之间的距离  
2. 当日最高价与昨日收市价之间的距离  
3. 当日最低价与昨日收市价之间的距离  

##### +DI和-DI  
方向指数，相对于真实价格范围，变动的百分比。  
<img src="/images/技术交易系统新概念笔记/动向指标-DI.jpg" />  

价格**上涨**用`+DI`，**下跌**用`-DI`。  

<img src="/images/技术交易系统新概念笔记/动向指标-DI14.jpg" />  

> 求出`14`天的平均值来作为指标，
计算出14天的值以后便可以用简便方法进行计算。  

<img src="/images/技术交易系统新概念笔记/动向指标-DI14-next.jpg" />  

#### 数据记录  
|  date   | open  |  high   | low  |  close   | TR  |  DMHigh   | DMLow  |  TR14   |  DI14High   | DI14Low  | DIDiff  | DISum  | DX  | ADX  |
|  ----  | ----  |  ----  | ----  |  ----  | ----  |  ----  | ----  |  ----  | ----  | ----  | ----  | ----  | ----  |
| 日期  | 开盘价 | 最高价  | 最低价 | 收盘价  | 真实价格范围 | +DM  | -DM | TR14 | +DI14  | -DI14 | +DI14 - (-DI14) | +DI14 + (-DI14) | DIDiff / DISum | 14天DX的平均值 |


##### 

## 结束  
