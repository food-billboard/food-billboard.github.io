---
title: æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°
date: 2022-11-28 09:13:00
tags: trade finance 
banner_img: /images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/background.jpeg
index_img: /images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/background.jpeg
categories: 
  - äº¤æ˜“
---

# æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°  

## ä»‹ç»  
  æœ¬æ–‡æ˜¯æœ¬äººåœ¨é˜…è¯»äº†ã€ŠæŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µã€‹æ‰€ä½œçš„ç¬”è®°ã€‚  

## å¼€å§‹  

### ç›®å½• 

  è®°å½•ä¸€ä¸‹ç›®å½•ï¼š  
> 
  ç¬¬ä¸€ç«  åŸºæœ¬æ¦‚å¿µ  
  ç¬¬äºŒç«  æŠ›ç‰©å¼æ—¶é—´/ä»·æ ¼äº¤æ˜“ç³»ç»Ÿ  
  ç¬¬ä¸‰ç«  æ³¢åŠ¨äº¤æ˜“ç³»ç»Ÿ  
  ç¬¬å››ç«  åŠ¨å‘æŒ‡æ ‡  
  ç¬¬äº”ç«  åŠ¨é‡æ¦‚å¿µ-è¶‹åŠ¿å¹³è¡¡ç‚¹äº¤æ˜“ç³»ç»Ÿ  
  ç¬¬å…­ç«  ç›¸å¯¹å¼ºå¼±æŒ‡æ•°  
  ç¬¬ä¸ƒç«  è¶‹åŠ¿-å›è°ƒäº¤æ˜“ç³»ç»Ÿ  
  ç¬¬å…«ç«  æ‘†åŠ¨æŒ‡æ ‡-çŸ­çº¿äº¤æ˜“ç³»ç»Ÿ  
  ç¬¬ä¹ç«  æœŸè´§å“ç§é€‰æ‹©æŒ‡æ ‡CSI  
  ç¬¬åç«  èµ„é‡‘ç®¡ç†  

### åŸºæœ¬æ¦‚å¿µ  

è¿™é‡Œç”¨åˆ°çš„ä¸€äº›æ¦‚å¿µä¼šè´¯ç©¿æ‰€æœ‰ç« èŠ‚ä½¿ç”¨ï¼Œéœ€è¦æå‰è®°å¥½ã€‚  

#### LOP | HIP  

- LOP  
å…¶ç›¸é‚»çš„ä¸¤æ ¹Kçº¿çš„æœ€ä½ä»·éƒ½é«˜äºå…¶æœ€ä½ä»·  
- HIP  
å…¶ç›¸é‚»çš„ä¸¤æ ¹Kå…ˆçš„æœ€é«˜ä»·å‡ä½äºå…¶æœ€é«˜ä»·  

<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/LOP-HIP.png" />

#### SIP(HI SIP | LO SIP)  

ç®€å•æ¥è¯´åº”è¯¥å°±æ˜¯æœ€é«˜å’Œæœ€ä½ä»·æ ¼çš„æ„æ€å§ã€‚  

<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/SIP.png" />

#### SIC   

è¡¨ç¤ºäº¤æ˜“ä¸­æœ€æœ‰åˆ©çš„**æ”¶ç›˜ä»·**ã€‚  
å¤šå¤´è¡¨ç¤ºæœ€é«˜ä»·ã€‚  
ç©ºå¤´è¡¨ç¤ºæœ€ä½ä»·ã€‚  

#### SAR  

åœæ­¢åè½¬ç‚¹ï¼Œè¡¨ç¤ºåœæ­¢ç°æœ‰å¤´å¯¸ï¼Œåæ–¹å‘æ“ä½œã€‚  

#### TR  

  çœŸå®ä»·æ ¼èŒƒå›´   
  å»ä¸‹åˆ—å€¼ä¸­çš„æœ€å¤§å€¼  
  1. æœ€é«˜ä»·ä¸æœ€ä½ä»·çš„å·®  
  2. æœ€é«˜ä»·ä¸æ˜¨æ—¥æ”¶ç›˜ä»·çš„å·®  
  3. æœ€ä½ä»·ä¸æ˜¨æ—¥æ”¶ç›˜ä»·çš„å·®  

#### MOCKæ¨¡æ¿  
  è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹`javascript`å®ç°çš„ä¸€ä¸ªä»£ç ä»»åŠ¡è¿è¡Œæ¨¡æ¿ï¼ˆå…¶å®å°±æ˜¯æ€•è‡ªå·±å¿˜è®°ğŸ˜ ï¼‰  
```js

  const DATA_SOURCE = []

  // è·å–æŒ‡å®šæ—¶é—´é—´éš”çš„å†å²æ•°æ®
  // mock 
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // è·å–çœŸå®ä»·æ ¼èŒƒå›´
  function getTR(currentData, yestodayData) {
    const abs = Math.abs
    return Math.max(abs(currentData.high - currentData.low), abs(currentData.high - yestodayData.close), abs(currentData.low - yestodayData.close))
  }

  // å®šæ—¶ä»»åŠ¡æ‰§è¡Œ
  function dailyFunction() {

  }

```

### æŠ›ç‰©å¼æ—¶é—´/ä»·æ ¼äº¤æ˜“ç³»ç»Ÿ  

  ä¸ªäººè®¤ä¸ºï¼š  
  éå¸¸åå‘æ•°å­¦æ–¹æ³•çš„è¶‹åŠ¿è·Ÿè¸ªç³»ç»Ÿã€‚  
  åªè¦è®°ä½ä»–çš„è®¡ç®—åŠŸèƒ½ï¼Œå°±éå¸¸å®¹æ˜“å®Œæˆæ•´ä¸ªç³»ç»Ÿã€‚  
  é©¬ä¸Šå°±å¯ä»¥å°è¯•ä½¿ç”¨ä»£ç å®Œæˆç³»ç»Ÿã€‚  

  è®°ä½å‡ ä¸ªå…³é”®çš„å‚æ•°ï¼š  
  - AF  
    åŠ é€Ÿå› å­[0.02-0.2]  
    å½“æ—¥åˆ›ä¸‹ä»·æ ¼æ–°é«˜åˆ™`AF+0.02`(å¤šå¤´ä¸ºæ–°é«˜ï¼Œç©ºå¤´ä¸ºæ–°ä½)    
  - SAR  
    åœæ­¢åè½¬ç‚¹  
  - SIP  
    ä»·æ ¼æå€¼  
  - EP  
    æ­¤æ¬¡äº¤æ˜“å¼€å§‹çš„æœ€æå€¼ï¼ˆå¤šå¤´ä¸ºæœ€é«˜ï¼Œç©ºå¤´ä¸ºæœ€ä½ï¼‰ã€‚       

  `æ˜æ—¥SAR = ä»Šæ—¥SAR + AF(ä»Šæ—¥æœ€é«˜ä»· - ä»Šæ—¥SAR)`  

#### è§„åˆ™  
  - å…¥å¸‚æ—¶æœº  
    ä»·æ ¼çªç ´`SAR`  
  - å»ºä»“ç¬¬ä¸€å¤©  
    SAR = å‰ä¸€æ¬¡äº¤æ˜“SIP  
  - ç¬¬ä¸€å¤©ä¹‹å  
    å¤šå¤´ï¼š`æ˜æ—¥SAR = ä»Šæ—¥SAR + AF(æœ€é«˜ä»· - ä»Šæ—¥SAR)`  
    ç©ºå¤´ï¼š`æ˜æ—¥SAR = ä»Šæ—¥SAR - AF(æœ€ä½ä»· - ä»Šæ—¥SAR)`  
  - SARä¸å…è®¸å‡ºç°åœ¨å‰ä¸€æ—¥æˆ–ä»Šæ—¥ä»·æ ¼åŒºåŸŸ  
    å¤šå¤´ï¼šæ˜æ—¥SARä¸èƒ½å¤§äºæ˜¨æ—¥æˆ–ä»Šæ—¥æœ€ä½ä»·ï¼Œå¤§äºåˆ™`æ˜æ—¥SAR = min(ä»Šæ—¥æœ€ä½ä»·ï¼Œæ˜æ—¥æœ€ä½ä»·)`  
    ç©ºå¤´ï¼šæ˜æ—¥SARä¸èƒ½å°äºæ˜¨æ—¥æˆ–ä»Šæ—¥æœ€é«˜ä»·ï¼Œå°äºåˆ™`æ˜æ—¥SAR = max(ä»Šæ—¥æœ€é«˜ä»·ï¼Œæ˜æ—¥æœ€é«˜ä»·)`  

```typescript
  let DATASOURCE: {
    state: 1 | -1 // 1 å¤šå¤´ -1 ç©ºå¤´
    dailyData: { // æ¯æ—¥çš„äº¤æ˜“æ•°æ®
      date: string // æ—¥æœŸ
      open: number // å¼€ç›˜ä»·
      high: number // æœ€é«˜ä»·
      low: number // æœ€ä½ä»·
      close: number // æ”¶ç›˜ä»·
      SAR: number 
      EP: number // æ­¤æ¬¡äº¤æ˜“çš„æå€¼
      EP_SAR: number // EP+-SAR å½“å‰æœ€é«˜ä»·å’Œä»Šæ—¥SAR çš„å·®å€¼
      AF: number // åŠ é€Ÿå› å­
      AF_DIFF: number // EP_SAR * AF  
    }[]
  } = []

  // æ¨¡æ‹Ÿäº¤æ˜“
  // ç”¨äºä¸‹é¢çš„é¦–æ¬¡å…¥å¸‚å‰çš„å‡†å¤‡å·¥ä½œ
  let MOCK_DATASOURCE = []

  // è·å–æŒ‡å®šæ—¶é—´é—´éš”çš„å†å²æ•°æ®
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // ä¹‹å‰ä»æœªåšè¿‡äº¤æ˜“
  // éœ€è¦å…ˆæ‰¾å‡ºå‰å‡ å‘¨å‰çš„ æœ€é«˜|æœ€ä½ ç‚¹  
  // åŸºäºæ˜¯ä¸Šå‡è¿˜æ˜¯ä¸‹è·Œè¶‹åŠ¿  
  // å½“å‰è®¾ç½®ä¸º3å‘¨å‰  
  function getBeforeWeekPeak() {

    // è·å–3å‘¨çš„æ—¶é—´é—´éš”
    let startDate
    let endDate 

    // ç¬¬ä¸€å¤©å¯ç”¨ç¨‹åº
    if(!MOCK_DATASOURCE.length) {
      const historyData = getHistoryData()
      // TODO 
      // åˆ¤æ–­å‰å‡ å‘¨çš„è¶‹åŠ¿
      
      let peakData 
      let peakIndex 
      // å¦‚æœæ˜¯ä¸Šå‡
      if(true) {
        // æ‰¾å‡ºå‰ä¸‰å‘¨çš„æœ€é«˜ç‚¹
        historyData.forEach((history, index) => {
          if(!peakData || history.high > peakData.high) {
            peakData = history 
            peakIndex = index 
          }
        })
        // æ‰¾å‡ºæœ€é«˜ç‚¹å4å¤©çš„æœ€ä½ç‚¹
        // ä½œä¸ºå…¥å¸‚ç‚¹
        const enterDate = historyData.slice(peakIndex, peakIndex + 4)
        const SAR = peakData.high
        const EP = enterDate.low
        const EP_SAR = Math.abs(SAR - EP)
        MOCK_DATASOURCE.push({
          state: -1,
          dailyData: [
            date: enterDate.date,
            open: enterDate.open,
            high: enterDate.high,
            low: enterDate.low,
            close: enterDate.close,
            SAR, 
            EP,
            EP_SAR,
            AF: 0.02,
            AF_DIFF: EP_SAR * 0.02
          ]
        })
      }
      // ä¸‹è·Œ
      else {
        // æ‰¾å‡ºå‰ä¸‰å‘¨çš„æœ€ä½ç‚¹
        historyData.forEach((history, index) => {
          if(!peakData || history.low < peakData.low) {
            peakData = history 
            peakIndex = index 
          }
        })
        // æ‰¾å‡ºæœ€ä½ç‚¹å4å¤©çš„æœ€é«˜ç‚¹
        // ä½œä¸ºå…¥å¸‚ç‚¹
        const enterDate = historyData.slice(peakIndex, peakIndex + 4)

        const SAR = peakData.low
        const EP = enterDate.high
        const EP_SAR = Math.abs(SAR - EP)
        MOCK_DATASOURCE.push({
          state: 1,
          dailyData: [
            date: enterDate.date,
            open: enterDate.open,
            high: enterDate.high,
            low: enterDate.low,
            close: enterDate.close,
            SAR, 
            EP,
            EP_SAR,
            AF: 0.02,
            AF_DIFF: EP_SAR * 0.02
          ]
        })
      }
    }

    // TODO 
    // æŒç»­è¿›è¡Œæ¨¡æ‹Ÿè®°å½•æ•°æ®
    // ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç‚¹è¿˜æ²¡æœ‰å¼„æ¸…æ¥š
    // å…ˆæš‚æ—¶å¡ç€å§

  }

  // æ¯æ—¥éœ€è¦æ‰§è¡Œçš„å‡½æ•°
  function dailyFunction(options={
    mock: false,
    date: null 
  }) {

    const { mock, date } = options 
    const _DATASOURCE = mock ? MOCK_DATASOURCE : DATASOURCE

    // åˆå§‹åŒ–ä»Šæ—¥æ•°æ®
    const todayData = getHistoryData(date, date)
    const newDailyData = {
      ...todayData,
    }

    // ä¹‹å‰æœªåšè¿‡äº¤æ˜“
    // å¯ä»¥é€‰æ‹©ä»¥ä¸‹æ–¹æ³•
    // ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨åé¢è¯´åˆ°çš„ç¬¬å››ç« çš„æ–¹æ³•ï¼ˆåŠ¨å‘æŒ‡æ•°ï¼‰
    if(!_DATASOURCE.length) {
      return getBeforeWeekPeak()
    }

    // æ˜¯å¦ä»Šæ—¥å¼€å¯äº¤æ˜“
    const lastTradeNote = _DATASOURCE[_DATASOURCE.length - 2]
    const currentTradeNote = _DATASOURCE[_DATASOURCE.length - 1]
    const { dailyData, state } = currentTradeNote

    // ç¬¬ä¸€å¤©
    if(!dailyData.length) {
      // ä¹‹å‰å­˜åœ¨äº¤æ˜“
      if(!!lastTradeNote && Array.isArray(lastTradeNote.dailyData) && lastTradeNote.dailyData.length) {
        const { dailyData, state } = lastTradeNote
        // å¤šå¤´åˆ™è·å–å‰ä¸€æ¬¡äº¤æ˜“çš„æœ€ä½ä»·
        // ç©ºå¤´åˆ™è·å–å‰ä¸€æ¬¡äº¤æ˜“çš„æœ€é«˜ä»·
        // è¿™é‡Œåªéœ€è¦å–å‰ä¸€æ¬¡äº¤æ˜“çš„æœ€åä¸€å¤©çš„æå€¼EPå³å¯
        newDailyData.SAR = dailyData[dailyData.length - 1].EP
        newDailyData.EP = state === 1 ? newDailyData.high : newDailyData.low
      }
    }
    // éç¬¬ä¸€å¤©
    else {
      // å‰ä¸€å¤©çš„æ•°æ®
      const yestodayData = dailyData[dailyData.length - 1]
      const beforeYestodayData = dailyData[dailyData.length - 2] || {
        low: 999999,
        high: -1
      }
      
      if(state === 1) {
        newDailyData.SAR = yestodayData.SAR + yestodayData.AF_DIFF
        // å¤šå¤´ SAR ä¸å¾—å¤§äºå‰ä¸€æ—¥æˆ–ä»Šæ—¥æœ€ä½ä»·ï¼Œå¤§äºåˆ™é€‰æ‹©å½“æ—¥æˆ–æ˜¨æ—¥æœ€ä½ä»·
        const lessThenPrize = Math.min(yestodayData.low, beforeYestodayData.low)
        newDailyData.SAR = newDailyData.SAR === Math.min(lessThenPrize, newDailyData.SAR) ? newDailyData.SAR : lessThenPrize

        newDailyData.EP = Math.max(yestodayData.EP, newDailyData.high)
      }else {
        newDailyData.SAR = yestodayData.SAR - yestodayData.AF_DIFF
        // ç©ºå¤´ SAR ä¸å¾—å°äºå‰ä¸€æ—¥æˆ–ä»Šæ—¥æœ€é«˜ä»·ï¼Œå°äºåˆ™é€‰æ‹©å…šæ—¥æˆ–æ˜¨æ—¥æœ€é«˜ä»·
        const greatThenPrize = Math.max(yestodayData.high, beforeYestodayData.high)
        newDailyData.SAR = newDailyData.SAR === Math.max(lessThenPrize, newDailyData.SAR) ? newDailyData.SAR : lessThenPrize

        newDailyData.EP = Math.min(yestodayData.EP, newDailyData.low)
      }
    }

    // è·å– EP å’Œ SAR çš„å·®å€¼
    newDailyData.EP_SAR = Math.abs(newDailyData.SAR - newDailyData.EP)
    newDailyData.AF = newDailyData.AF || 0.02 
    // åˆ›æ–°é«˜æˆ–æ–°ä½åˆ™å¢åŠ AFå€¼
    if(state === 1) {
      newDailyData.AF += newDailyData.high > newDailyData.EP ? 0.02 : 0
    }else {
      newDailyData.AF += newDailyData.low < newDailyData.EP ? 0.02 : 0
    }
    newDailyData.AF = Math.min(0.2, newDailyData.AF)
    newDailyData.AF_DIFF = newDailyData.AF * newDailyData.EP_SAR

    // å¤šå¤´å‘ç”Ÿä»·æ ¼çªç ´
    const isMultiBreak = state === 1 && newDailyData.low < newDailyData.SAR
    // ç©ºå¤´å‘ç”Ÿä»·æ ¼çªç ´
    const isEmptyBreak = state === -1 && newDailyData.high > newDailyData.SAR

    if(isMultiBreak || isEmptyBreak) {
      newDailyData.AF = 0.02 
      newDailyData.SAR = newDailyData.EP 
      newDailyData.EP = state === 1 ? newDailyData.low : newDailyData.high 
      newDailyData.EP_SAR = Math.abs(newDailyData.SAR - newDailyData.EP)
      newDailyData.AF_DIFF = newDailyData.EP_SAR * newDailyData.AF

      console.log((state === 1 ? 'å¤šå¤´' : 'ç©ºå¤´') + 'ä»·æ ¼å‘ç”Ÿçªç ´')

      _DATASOURCE.push({
        state: -1,
        dailyData: [
          {
            ...newDailyData,
          }
        ]
      })
    }
    // è®°å½•ä»Šæ—¥æ•°æ®
    else {
      console.log('ä»Šæ—¥ä»·æ ¼æ•°æ®:' + JSON.stringify(newDailyData))
      _DATASOURCE[_DATASOURCE.length - 1].dailyData.push(newDailyData)
    }

  }

  // æ•°æ®æ¸…ç©º
  function clearData() {
    DATASOURCE = {
      state: 1,
      dailyData: []
    }
    MOCK_DATASOURCE = {
      state: 1,
      dailyData: []
    }
  }


```

### æ³¢åŠ¨äº¤æ˜“ç³»ç»Ÿ  

ä¹Ÿæ˜¯ä¸€ä¸ªè¶‹åŠ¿è·Ÿè¸ªçš„ç³»ç»Ÿã€‚  
æ ¹æ®å¸‚åœºçš„æ³¢åŠ¨æ€§æ¥ä½œå‡ºç›¸åº”çš„æ“ä½œã€‚  

- `ATR`è®¡ç®—  
<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/æ³¢åŠ¨äº¤æ˜“ç³»ç»Ÿ-ATR.jpg" />  

`ATR_t`æ˜¯å½“æ—¥å¹³å‡çœŸå®ä»·æ ¼èŒƒå›´ï¼Œ`ATR_p`æ˜¯å‰ä¸€æ—¥çš„å¹³å‡çœŸå®ä»·æ ¼èŒƒå›´ã€‚  
`TR`æ˜¯å½“æ—¥çœŸå®ä»·æ ¼èŒƒå›´ã€‚  

ä¸Šè¿°è®¡ç®—æ˜¯æ ¹æ®ä¸ƒä¸ªäº¤æ˜“æ—¥ä¸ºæ ‡çš„åšçš„è®¡ç®—ã€‚  
`ATR_p`å³å°†åŠ ä¸Šä»Šæ—¥ä»¥åŠå‰6ä¸ªäº¤æ˜“æ—¥çš„çœŸå®ä»·æ ¼èŒƒå›´ç›¸åŠ ï¼Œå¹¶é™¤7å¾—å‡ºçš„ï¼Œä¹‹åæ¯ä¸€æ—¥çš„è®¡ç®—åªè¦ç®€å•å¾—å°†**å‰ä¸€æ—¥çš„å¹³å‡çœŸå®ä»·æ ¼èŒƒå›´**å¸¦å…¥ä¸Šè¿°å…¬å¼å³å¯ã€‚  

- ARC 
  `ARC = ATR * C`  
  Cæ˜¯ä¸€ä¸ª[2.8, 3.1]ä¹‹é—´çš„å¸¸æ•°ï¼ˆä¸€èˆ¬ä¸º3ï¼‰ã€‚  

- ç³»ç»Ÿäº¤æ˜“è§„åˆ™  

  è®¡ç®—å‡ºä¸ƒå¤©çš„`ARC`ï¼Œæ‰¾å‡ºä¸ƒå¤©æœ€é«˜æ”¶ç›˜ä»·`SIC`ï¼Œ`SAR = SIC - ARC`  
  è‹¥ç¬¬äºŒæ—¥çš„æ”¶ç›˜ä»·ä½äº`SAR`ï¼Œå¹³ä»“å»ºç«‹ç©ºå¤´ã€‚  
  

#### çœŸå®ä»·æ ¼èŒƒå›´  

  å–ä»¥ä¸‹ä¸‰ç§çš„æœ€å¤§å€¼ã€‚  
  1. å½“æ—¥æœ€é«˜ä»·åˆ°å½“æ—¥æœ€ä½ä»·çš„èŒƒå›´ã€‚  
  2. æ˜¨æ—¥æ”¶ç›˜ä»·åˆ°å½“æ—¥æœ€é«˜ä»·çš„èŒƒå›´ã€‚  
  3. æ˜¨æ—¥æ”¶ç›˜ä»·åˆ°å½“æ—¥æœ€ä½ä»·çš„èŒƒå›´ã€‚  

#### ä»£ç å®ç°  
```typescript 

  // å¸¸æ•°C 
  const C = 3 // [2.8, 3]

  const DATA_SOURCE: {
    state: 1 | -1 // å½“å‰æ˜¯ç©ºå¤´(-1)è¿˜æ˜¯å¤šå¤´(1)
    TR: number // å½“æ—¥çš„çœŸå®ä»·æ ¼èŒƒå›´
    ATR: number // å½“æ—¥çš„å¹³å‡çœŸå®ä»·æ ¼èŒƒå›´
    ARC: number // ATR * C
    SAR: number // åœæ­¢åè½¬ç‚¹  
    SIC: number // æœ€ä½æ”¶ç›˜ä»·
    high: number 
    close: number 
    low: number 
    open: number 
    date: string 
  } = []

  // è·å–æŒ‡å®šæ—¶é—´é—´éš”çš„å†å²æ•°æ®
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // è·å–çœŸå®ä»·æ ¼èŒƒå›´
  function getTR(currentData, yestodayData) {
    const abs = Math.abs
    return Math.max(abs(currentData.high - currentData.low), abs(currentData.high - yestodayData.close), abs(currentData.low - yestodayData.close))
  }

  // æ¯æ—¥å®šæ—¶æ‰§è¡Œæ–¹æ³•
  function dailyFunction() {

    const currentDateData = getHistoryData()

    // ä¹‹å‰æœªåšè¿‡ä»»ä½•äº¤æ˜“
    if(DATA_SOURCE.length < 7) {
      // ç®€å•ä»ç©ºå¤´ä½ç½®å¼€å§‹å‡†å¤‡è¿›å…¥å¸‚åœº
      if(DATA_SOURCE.length < 6) {
        DATA_SOURCE.push({
          ...currentDateData,
          TR: getTR()
        })
      }else {
        const TR = getTR()
        const ATR = DATA_SOURCE.map(item => item.TR).reduce((acc, cur) => acc + cur, 0) / 7
        DATA_SOURCE.push({
          ...currentDateData,
          TR,
          ATR,
          ARC: ATR * C
        })
      }
    }

    const [lastDayData] = DATA_SOURCE.slice(-1)

    const todayTR = getTR(currentDateData, lastDayData)
    const todayATR = (6 * lastDayData.ATR + todayTR) / 7
    const ARC = todayATR * C
    let SIC 
    let SAR 
    let state 
    // ç©ºå¤´
    if(lastDayData.state == -1) {
      SIC = Math.min(lastDayData.SIC, currentDateData.close)
      SAR = lastDayData.SIC + lastDayData.ARC
      // æ”¶ç›˜ä»·ä¸Šç©¿SAR å˜ä¸ºå¤šå¤´
      state = currentDateData.close > SAR ? 1 : -1
      // å˜ä¸ºå¤šå¤´æ›´æ”¹SICä¸ºå½“æ—¥æ”¶ç›˜ä»·
      if(state === 1) {
        SIC = currentDateData.close
      }
    }
    // å¤šå¤´
    else {
      SIC = Math.max(lastDayData.SIC, currentDateData.close)
      SAR = lastDayData.SIC - lastDayData.ARC
      // æ”¶ç›˜ä»·ä¸‹ç©¿SAR å˜ä¸ºç©ºå¤´
      state = currentDateData.close < SAR ? -1 : 1
      // å˜ä¸ºç©ºå¤´æ›´æ”¹SICä¸ºå½“æ—¥æ”¶ç›˜ä»·
      if(state === 1) {
        SIC = currentDateData.close
      }
    }

    const newData = {
      ...currentDateData,
      TR: todayTR,
      ATR: todayATR,
      ARC,
      SIC,
      SAR,
      state
    }

    // ä¸Šé¢stateæ”¹å˜åˆ™è§¦å‘äº¤æ˜“æ“ä½œ
    DATA_SOURCE.push(newData)

  }

```

### åŠ¨å‘æŒ‡æ ‡  

æ ¹æ®ä¸€ä¸ª`0-100`çš„æŒ‡æ ‡æ¥è·Ÿè¸ªäº§å“è¶‹åŠ¿ã€‚  

#### å‡ ä¸ªæŒ‡æ ‡æ¦‚å¿µ  

##### +DMå’Œ-DM  
ä»Šæ—¥çš„ä»·æ ¼èŒƒå›´ä¸æ˜¨æ—¥ä»·æ ¼è¿”å›çš„å·®å€¼  
æ¯”å¦‚ï¼šæ˜¨å¤©çš„ä»·æ ¼èŒƒå›´æ˜¯`[100 200]`ï¼Œä»Šæ—¥çš„ä»·æ ¼èŒƒå›´æ˜¯`[150, 300]`ï¼Œåˆ™ä½¿ç”¨`+DM`è¡¨ç¤ºä¸º`300 - 200 = 100`  
<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/åŠ¨å‘æŒ‡æ ‡-DM.jpg" />

å½“ä»Šæ—¥ä¸æ˜¨æ—¥æ˜¯**åŒ…å«**å…³ç³»æ—¶ï¼ŒDMä¸º`0`ã€‚  
`+DM`å’Œ`-DM`å§‹ç»ˆæ˜¯**æ­£æ•°**ã€‚  

> è®¡ç®—è§„åˆ™  
å…šæ—¥ä»·æ ¼èŒƒå›´è¶…å‡ºæ˜¨æ—¥ä»·æ ¼èŒƒå›´ä¸­çš„è¾ƒå¤§éƒ¨åˆ†ã€‚  

##### +DIå’Œ-DI  
æ–¹å‘æŒ‡æ•°ï¼Œç›¸å¯¹äºçœŸå®ä»·æ ¼èŒƒå›´ï¼Œå˜åŠ¨çš„ç™¾åˆ†æ¯”ã€‚  
<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/åŠ¨å‘æŒ‡æ ‡-DI.jpg" />  

ä»·æ ¼**ä¸Šæ¶¨**ç”¨`+DI`ï¼Œ**ä¸‹è·Œ**ç”¨`-DI`ã€‚  

<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/åŠ¨å‘æŒ‡æ ‡-DI14.jpg" />  

> æ±‚å‡º`14`å¤©çš„å¹³å‡å€¼æ¥ä½œä¸ºæŒ‡æ ‡ï¼Œ
è®¡ç®—å‡º14å¤©çš„å€¼ä»¥åä¾¿å¯ä»¥ç”¨ç®€ä¾¿æ–¹æ³•è¿›è¡Œè®¡ç®—ã€‚  

<img src="/images/æŠ€æœ¯äº¤æ˜“ç³»ç»Ÿæ–°æ¦‚å¿µç¬”è®°/åŠ¨å‘æŒ‡æ ‡-DI14-next.jpg" />  

##### DX  
åŠ¨å‘æŒ‡æ ‡  
`DX = DIDiff / DISum`ï¼ˆå‚æ•°è¯¦è§ä¸‹è¡¨ï¼‰  
`DX`å€¼è¶Šå¤§ï¼Œè¿åŠ¨è¶Š**å¼º**ï¼›`DX`å€¼æœˆé”€ï¼Œè¿åŠ¨è¶Š**å¼±**ã€‚  
æ— è®ºä»·æ ¼å‘ä¸Šæˆ–å‘ä¸‹è¿åŠ¨ï¼Œä¸ä¼šå½±å“æ•°å€¼ï¼Œå³å‘ä¸Šæˆ–å‘ä¸‹è¿åŠ¨å¹…åº¦å¤§ï¼Œé‚£ä¹ˆä»–çš„å€¼éƒ½å¾ˆ**å¤§**ã€‚  

##### ADX  
 14å¤©`DX`çš„å¹³å‡å€¼  

##### ADXR  
  æ–¹å‘è¿åŠ¨çš„åæ ‡ç³»ä¸Šç”¨äºé‡åº¦æœŸè´§ã€è´§å¸ã€è‚¡ç¥¨ç­‰ç­‰çš„ä»·æ ¼å˜åŒ–çš„ä¸€ä¸ªæŒ‡æ ‡  
  `ADXR = (å½“æ—¥ADX + 14å¤©å‰çš„ADX14) / 2`

##### CSI & K  

  **ç¬¬ä¹ç« **ä¼šä»‹ç»  

#### æ•°æ®è®°å½•  
|  date   | open  |  high   | low  |  close   | TR  |  DMHigh   | DMLow  |  TR14   |  DI14High   | DI14Low  | DIDiff  | DISum  | DX  | ADX  |
|  ----  | ----  |  ----  | ----  |  ----  | ----  |  ----  | ----  |  ----  | ----  | ----  | ----  | ----  | ----  |
| æ—¥æœŸ  | å¼€ç›˜ä»· | æœ€é«˜ä»·  | æœ€ä½ä»· | æ”¶ç›˜ä»·  | çœŸå®ä»·æ ¼èŒƒå›´ | +DM  | -DM | TR14 | +DI14  | -DI14 | +DI14 - (-DI14) | +DI14 + (-DI14) | DIDiff / DISum | 14å¤©DXçš„å¹³å‡å€¼ |

#### jså®ç°  
```js
  /*
    {
      // æ—¥æœŸ
      date: '2022-02-25',
      // å¼€ç›˜ä»·
      open: 100,
      // æœ€é«˜ä»·
      high: 100,
      // æœ€ä½ä»·
      low: 100,
      // æ”¶ç›˜ä»·
      close: 100,
      // TR  
      TR: 10,
      // +DM 
      DMHigh: 10, 
      // -DM  
      DMLow: 0,
      // TR14  
      TR14: 14,
      // DMHigh14
      DMHigh14: 10,
      // DMLow14
      DMLow14: 10,
      // +DI14 
      DI14High: 10,
      // -DI14
      DI14Low: 10,
      // +DI14å’Œ-DI14çš„å·®å€¼  
      DIDiff: 10,
      // +DI14å’Œ-DI14çš„å’Œ
      DISum: 10,
      // ä¸Šé¢ä¸¤ä¸ªå€¼çš„æ¯”å€¼ åŠ¨å‘æŒ‡æ ‡
      DX: 10,
      // 14æ—¥DXçš„å¹³å‡å€¼
      ADX: 30,
      // å¹³å‡åŠ¨å‘æŒ‡æ ‡æ¯”ç‡
      ADXR: 30,
      // å¹³å‡14å¤©çœŸå®ä»·æ ¼èŒƒå›´
      ATR14: 20,
      // æœŸè´§å“ç§é€‰æ‹©æŒ‡æ ‡
      CSI: 20
    }
  */
  const DATA_SOURCE = []
  // å½“å‰çš„äº¤æ˜“ä¿¡æ¯
  const TRADE_INFO = {
    // -1 åˆå§‹åŒ– 0 ç©ºå¤´ 1 å¤šå¤´
    status: -1,
    // DI14å’Œ-DI14äº¤å‰æ—¶çš„æç«¯ä»·ä½ï¼Œç”¨äºæ¶ˆé™¤ä»·æ ¼æ³¢åŠ¨å™ªå£°  
    limit: -1,
  }

  // æ—¶é—´è·¨åº¦ 14 å¤©
  const RANGE_DAY_COUNT = 14 

  // è·å–æŒ‡å®šæ—¶é—´é—´éš”çš„å†å²æ•°æ®
  // mock 
  function getHistoryData(start, end) {
    const date = new Date()
    return [{
      high,
      open,
      low,
      close,
      date: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`
    }]
  }

  // è·å–DMå€¼ 
  function getDMData(currentData, yestodayData) {
    const {  
      high: currHigh,
      low: currLow
    } = currentData 
    const {  
      high,
      low
    } = yestodayData 
    let DMHigh = 0 
    let DMLow = 0 

    const condition1 = currHigh - high 

    const condition2 = low - currLow 

    // å¦‚æœæ˜¯åŒ…å«å…³ç³»å°±éƒ½ä¸º0 
    if(condition1 > 0 || condition2 > 0) {
      // å‘ä¸Šè¿åŠ¨æ›´å¤š
      if(condition1 > condition2) {
        DMHigh = condition1
      }
      // å‘ä¸‹è¿åŠ¨æ›´å¤š
      else {
        DMLow = condition2
      }
    }

    return {
      DMHigh,
      DMLow
    }
  }

  // è·å–çœŸå®ä»·æ ¼èŒƒå›´
  function getTR(currentData, yestodayData) {
    const abs = Math.abs
    return Math.max(abs(currentData.high - currentData.low), abs(currentData.high - yestodayData.close), abs(currentData.low - yestodayData.close))
  }

  // å®šæ—¶ä»»åŠ¡æ‰§è¡Œ
  function dailyFunction() {

    const currentData = getHistoryData() 
    const {
      high,
      open,
      low,
      close,
      date
    } = currentData 
    const newData = {
      date,
      high,
      open,
      close,
      low,
    } 

    // ä¸æ˜¯ç¬¬ä¸€å¤©ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€å¤©åªéœ€è¦ç®€å•è®°å½•æ•°æ®å°±å¯ä»¥äº†
    if(!DATA_SOURCE.length) {
      const yestoday = DATA_SOURCE[DATA_SOURCE.length - 1]

      // DM
      const { DMHigh, DMLow } = getDMData(newData, yestoday)
      newData.DMHigh = DMHigh
      newData.DMLow = DMLow

      // TR  
      const tr = getTR(newData, yestoday)
      newData.TR = tr 

      // å¤§äºæœ€çŸ­æ—¶é—´å‘¨æœŸï¼ˆ14å¤©ï¼‰ï¼Œæ»¡è¶³æ‰€æœ‰æ•°æ®çš„è®¡ç®—æ¡ä»¶
      if(DATA_SOURCE.length >= (RANGE_DAY_COUNT - 1)) {
        
        // å¦‚æœæ˜¯åˆšå¥½æ»¡è¶³æ¡ä»¶ï¼Œéœ€è¦åšç´¯è®¡è®¡ç®—
        if(DATA_SOURCE.length == (RANGE_DAY_COUNT - 1)) {
          const previousData = DATA_SOURCE.slice(DATA_SOURCE.length - RANGE_DAY_COUNT - 1)

          // tr14 
          newData.TR14 = tr + previousData.reduce((acc, cur) => {
            acc += cur.TR
            return acc 
          }, 0)

          // dmhigh14 
          newData.DMHigh14 = DMHigh + previousData.reduce((acc, cur) => {
            acc += (cur.DMHigh || 0)
            return acc 
          }, 0)
          // dmlow14
          newData.DMLow14 = DMLow + previousData.reduce((acc, cur) => {
            acc += (cur.DMLow || 0)
            return acc 
          }, 0)

        }
        // è¶…è¿‡æ¡ä»¶åªè¦ç®€å•ä½¿ç”¨æ˜¨æ—¥æ•°æ®è¿›è¡Œè®¡ç®—å³å¯
        else {
          const { TR14, DMHigh14, DMLow14 } = yestoday

          // tr14
          newData.TR14 = TR14 - TR14 / RANGE_DAY_COUNT + tr 
          // dmhigh14 
          newData.DMHigh14 = DMHigh14 - DMHigh14 / RANGE_DAY_COUNT + DMHigh 
          // dmlow14 
          newData.DMLow14 = DMLow14 - DMLow14 / RANGE_DAY_COUNT + DMLow 

        }

        // ATR14
        newData.ATR14 = newData.TR14 / 14 
        // +DI14
        newData.DI14High = newData.DMHigh14 / newData.TR14 * 100 
        // -DI14
        newData.DI14Low = newData.DMLow14 / newData.TR14 * 100
        // DIDiff 
        newData.DIDiff = Math.abs(newData.DI14High - newData.DI14Low)
        // DISum
        newData.DISum = newData.DI14High + newData.DI14Low
        // DX  
        newData.DX = newData.DIDiff / newData.DISum * 100

        // è¶…è¿‡28å¤©å¯ä»¥å¼€å§‹è®¡ç®—ADX
        if(DATA_SOURCE.length >= (RANGE_DAY_COUNT * 2 - 1)) {
          // å¦‚æœæ˜¯åˆšå¥½æ»¡è¶³æ¡ä»¶ï¼Œéœ€è¦åšç´¯è®¡è®¡ç®—
          if(DATA_SOURCE.length == (RANGE_DAY_COUNT * 2 - 1)) {
            const previousData = DATA_SOURCE.slice(DATA_SOURCE.length - RANGE_DAY_COUNT - 1)

            // adx 
            newData.ADX = (newData.DX + previousData.reduce((acc, cur) => {
              acc += cur.DX
              return acc 
            }, 0)) / RANGE_DAY_COUNT

          }
          // è¶…è¿‡æ¡ä»¶åªè¦ç®€å•ä½¿ç”¨æ˜¨æ—¥æ•°æ®è¿›è¡Œè®¡ç®—å³å¯
          else {
            const { ADX } = yestoday

            // adx
            newData.ADX = (ADX * (RANGE_DAY_COUNT - 1) + newData.DX) / RANGE_DAY_COUNT

          }
        }

        // è¶…è¿‡14 * 3 å¤©å¼€å§‹è®¡ç®—ADXR
        // å› ä¸º28å¤©åæ‰èƒ½è®¡ç®—ADX
        // ADXRè®¡ç®—éœ€è¦14å¤©å‰çš„ADX
        if(DATA_SOURCE.length >= RANGE_DAY_COUNT * 3) {
          newData.ADXR = (newData.ADX + newData[newData.length - RANGE_DAY_COUNT]) / 2
        }

      }

    }

    // ---å…·ä½“çš„äº¤æ˜“æ“ä½œ---
    // è®¡ç®—å‡ºADXRæ‰ç®—èƒ½å¼€å§‹çœŸæ­£çš„äº¤æ˜“
    if(DATA_SOURCE.length >= RANGE_DAY_COUNT * 3) {

      // TODO 
      // è¿™éƒ¨åˆ†å†…å®¹åœ¨ç¬¬ä¹ç« æœ‰ä½“ç°
      // éœ€è¦æ ¹æ®CSIæ¥è¿›è¡Œç­›é€‰(CSIé«˜å¥½)  

      // ADXRè¶…è¿‡25è¡¨ç¤ºæœ‰åˆ©å¯å›¾
      if(newData.ADXR > 25) {

        // DI14 < -DI14 æ—¶å¤šå¤´
        // DI14 > -DI14 æ—¶ç©ºå¤´
        // ADX < (DI14&-DI14) æ—¶ç©ºå¤´
        // DI14 == -DI14


        // ç©ºå¤´ ADX < (DI14&-DI14)
        if(newData.ADX < newData.DI14High && newData.ADX < newData.DI14Low) {
          if(TRADE_INFO.status === 1) {
            TRADE_INFO.status = 0
            TRADE_INFO.limit = newData.high 
          }
        }
        // ç©ºå¤´
        else if(newData.DI14High > newData.DI14Low) {
          // åˆå§‹åŒ–æˆ–è€…å½“æ—¥æœ€ä½ä»· ä½äº äº¤å‰æ—¶çš„æœ€ä½ä»·
          // æ”¹åŠ¨ä¸ºç©ºå¤´
          if(TRADE_INFO.status === -1 || newData.low < TRADE_INFO.limit) {
            // èµ‹å€¼å½“å‰çš„ä¹°å–ä¿¡æ¯ï¼Œä¸ºä¸‹æ¬¡åšå‡†å¤‡
            TRADE_INFO.status = 1 
            TRADE_INFO.limit = newData.high
          }
        }
        // å¤šå¤´
        else if(newData.DI14High < newData.DI14Low) {
          // åˆå§‹åŒ–æˆ–è€…å½“æ—¥æœ€é«˜ä»· é«˜äº äº¤å‰æ—¶çš„æœ€é«˜ä»·
          // æ”¹åŠ¨ä¸ºå¤šå¤´
          if(TRADE_INFO.status === -1 || newData.high > TRADE_INFO.limit) {
            TRADE_INFO.status = 0 
            TRADE_INFO.limit = newData.low 
          }
        }

      }
    }

    // ---å…·ä½“çš„äº¤æ˜“æ“ä½œ---

    DATA_SOURCE.push(newData)

  }

```

> å­˜åœ¨é—®é¢˜  
  1. ä¸Šé¢`ADXR`è¶…è¿‡25æ‰æ˜¯æœ‰åˆ©å¯å›¾ï¼Œä½†æ˜¯å¦‚æœåœ¨äº§å“çš„`ADXR`è¶…è¿‡25æ—¶ä¹°å…¥ï¼Œä½†æ˜¯ä¹‹åé™ä½åˆ°äº†25ä»¥ä¸‹ï¼Œæ­¤æ—¶ï¼Œå…¥å¸‚çš„èµ„é‡‘è¯¥å¦‚ä½•å¤„ç†ã€‚  
  2. å¤§è¶‹åŠ¿ä¸‹ï¼Œå¦‚æŒç»­ä¸Šæ¶¨ï¼Œæ˜¯å¦éœ€è¦å¯¹æŒç»­**DIäº¤å‰**åšæ›´å¤šçš„èµ„é‡‘ä¹°å…¥ã€‚  
  3. å…·ä½“çš„äº¤æ˜“æ“ä½œè¿˜å¯ä»¥æ ¹æ®**ADX**æ¥è¿›è¡Œæ›´ç»†è‡´çš„åˆ¤æ–­ï¼Œæ›´å¤šç»†èŠ‚æœ‰å¾…æ¥ç€ç ”ç©¶ï¼ˆ55é¡µï¼‰ã€‚  
  4. ä¸Šè¿°ä»£ç éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡æ ‡`CSI`ï¼Œå¯èƒ½åœ¨ç¬¬ä¹ç« æœ‰è®²åˆ°ï¼Œå¾…é˜…è¯»ğŸ˜ ã€‚    

## ç»“æŸ  
