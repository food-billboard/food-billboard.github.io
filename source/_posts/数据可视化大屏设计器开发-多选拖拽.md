---
title: æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘-å¤šé€‰æ‹–æ‹½  
date: 2023-01-10 14:05:00
tags: lowcode react chart 
banner_img: /images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/background.jpg
index_img: /images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/background.jpg
categories: 
  - å‰ç«¯  
  - å¤§å±
---

# æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘-å¤šé€‰æ‹–æ‹½  

## å¼€å¤´  

æœ¬æ–‡æ˜¯æ•°æ®å¯è§†åŒ–å¼€å§‹çš„å¼€å‘ç»†èŠ‚ç¬¬äº”ç« ã€‚å…³äºç”»å¸ƒä¸­çš„å…ƒç´ çš„å„ç§é¼ æ ‡æ‹–æ‹½æ“ä½œã€‚    

> ç®€å•å£°æ˜  
æœ¬äººåªæ˜¯ä¸€ä¸ªèœé¸¡ï¼Œä»¥ä¸‹æ–¹æ³•ä»…ä¸ªäººæ€è·¯ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè½»å–·ğŸ™ğŸ» ã€‚  

> å¼€å¤´è¯´æ˜  
ä¸‹é¢æ‰€è¯´çš„**å…ƒç´ **è¡¨ç¤ºçš„æ˜¯**ç»„æˆ–è€…ç»„ä»¶**çš„ç®€ç§°ã€‚   

## å¼€å§‹  

å¤§å±è®¾è®¡å½“ä¸­ï¼Œä¸ä¹éœ€è¦è°ƒæ•´å›¾è¡¨ç»„ä»¶çš„**ä½ç½®**å’Œ**å°ºå¯¸**ã€‚  
ç›¸è¾ƒäºç½‘é¡µä½ä»£ç ï¼Œå›¾è¡¨å¤§å±ä½ä»£ç å¯èƒ½éœ€è¦æ›´å¤æ‚çš„æ“ä½œï¼Œæ¯”å¦‚åµŒå¥—**æˆç»„**ã€**å¤šé€‰**ã€**å•å…ƒç´ æ‹–æ‹½ç¼©æ”¾**ã€**å¤šå…ƒç´ æ‹–æ‹½ç¼©æ”¾**ã€‚  
å¹¶ä¸”éœ€è¦é’ˆå¯¹é¼ æ ‡çš„åŠ¨ä½œåšç›¸åº”çš„åŒºåˆ†ï¼Œå½“ä¸­åŒ…å«äº†ç›¸å½“çš„ç»†èŠ‚ï¼Œè¿™é‡Œå°±ä¸€ä¸€åšç›¸åº”çš„è®²è§£ã€‚  

### æ¶‰åŠçš„ä¾èµ–  

- react-rnd  
[react-rnd](https://github.com/bokuweb/react-rnd)æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‹–æ‹½å’Œç¼©æ”¾ä¸¤ä¸ªåŠŸèƒ½çš„`react`ç»„ä»¶ï¼Œå¹¶ä¸”æœ‰éå¸¸ä¸°å¯Œçš„é…ç½®é¡¹ã€‚  
å†…éƒ¨æ˜¯ä¾èµ–äº†æ‹–æ‹½([react-draggable](https://github.com/react-grid-layout/react-draggable))å’Œç¼©æ”¾ï¼ˆ[re-resizable](https://github.com/bokuweb/re-resizable)ï¼‰ä¸¤ä¸ªæ¨¡å—ã€‚  
å¥ˆä½•å®ƒå¹¶æ²¡æœ‰å†…ç½®å¤šå…ƒç´ çš„å“åº”æ“ä½œï¼Œæœ¬æ–‡å°±æ˜¯é’ˆå¯¹å®ƒæ¥å®ç°å¯¹åº”çš„æ“ä½œã€‚  

- react-selecto  
[react-selecto](https://github.com/daybrush/selecto/tree/master/packages/react-selecto)æ˜¯ä¸€ä¸ªç®€å•çš„ç®€å•æ˜“ç”¨çš„å¤šé€‰å…ƒç´ ç»„ä»¶ã€‚  

- eventemitter3  
[eventemitter3](https://github.com/primus/eventemitter3)æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶æ¨¡å—ï¼Œèƒ½å¤Ÿåœ¨ä»»ä½•åœ°æ–¹è§¦å‘å’Œå“åº”è‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œéå¸¸çš„æ–¹ä¾¿ã€‚  

### ç›¸å…³æ“ä½œ  

#### å¤šé€‰  
ç”»å¸ƒå½“ä¸­å¯ä»¥é€šè¿‡é¼ æ ‡ç‚¹å‡»æ‹–æ‹½å½¢æˆé€‰åŒºï¼Œé€‰åŒºå†…çš„å…ƒç´ å³æ˜¯è¢«é€‰ä¸­çš„çŠ¶æ€ã€‚  

è¿™é‡Œå³å¯ä»¥ä½¿ç”¨`react-selecto`æ¥å®ç°æ­¤åŠŸèƒ½ã€‚  
<img src="/images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/selecto-demo.gif" />

ä»å›¾ä¸Šæ“ä½œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨é€‰åŒºå†…çš„å…ƒç´ å³è¢«é€‰ä¸­ï¼ˆä¼šå‡ºç°é»‘è‰²è¾¹æ¡†ï¼‰ã€‚  

```typescript 
  import ReactSelecto from 'react-selecto';

  const Selecto = () => {

    return (
      <ReactSelecto
        // ä¼šè¢«é€‰ä¸­å…ƒç´ çš„çˆ¶å®¹å™¨ åªæœ‰è¿™ä¸ªå®¹å™¨é‡Œçš„å…ƒç´ æ‰ä¼šè¢«é€‰ä¸­  
        dragContainer={'#container'}
        // è¢«é€‰æ‹©çš„å…ƒç´ çš„query 
        selectableTargets={['.react-select-to']}
        // è¡¨ç¤ºå…ƒç´ æœ‰è¢«é€‰ä¸­çš„ç™¾åˆ†æ¯”ä¸ºå¤šå°‘æ—¶æ‰èƒ½è¢«é€‰ä¸­
        hitRate={10}
        // å½“å·²ç»å­˜åœ¨é€‰ä¸­é¡¹æ—¶ï¼ŒæŒ‰ä½æŒ‡å®šæŒ‰é”®å¯è¿›è¡Œç»§ç»­é€‰æ‹©  
        toggleContinueSelect={'shift'}
        // å¯ä»¥é€šè¿‡ç‚¹å‡»é€‰æ‹©å…ƒç´ 
        selectByClick
        // æ˜¯å¦ä»å†…éƒ¨å¼€å§‹é€‰æ‹©ï¼ˆï¼Ÿï¼‰
        selectFromInside
        // æ‹–æ‹½çš„é€Ÿç‡ï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ªæ„æ€ï¼‰
        ratio={0}
        // é€‰æ‹©ç»“æŸ
        onSelectEnd={handleSelectEnd}
      ></ReactSelecto>
    );
  };
```

è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚  
1. æ“ä½œäº’æ–¥  
ç”»å¸ƒå½“ä¸­çš„å¤šé€‰å’Œæ‹–æ‹½éƒ½æ˜¯é€šè¿‡é¼ æ ‡å·¦é”®æ¥å®Œæˆçš„ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªå…ƒç´ æ˜¯è¢«é€‰ä¸­çš„æ—¶å€™ï¼Œé¼ æ ‡æƒ³ä»å…ƒç´ ä¸Šå¼€å§‹æ‹–æ‹½é€‰æ‹©ç»„ä»¶æ˜¯ä¸è¢«å…è®¸çš„ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯æ‹–æ‹½å…ƒç´ ï¼Œè€Œä¸æ˜¯å¤šé€‰å…ƒç´ ã€‚  

è€Œå…ƒç´ å¦‚æœæ²¡æœ‰è¢«**é€‰ä¸­**æ—¶ï¼Œä¸Šé¢çš„æ“ä½œåˆ™å˜æˆäº†å¤šé€‰ã€‚  

<img src="/images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/rnd-select.gif" />  

2. å†…éƒ¨é€‰ä¸­  
ç”»å¸ƒå½“ä¸­æœ‰**ç»„**çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªç»„ä¸ç»„ä»¶æ— é™åµŒå¥—çš„ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥å•ç‹¬é€‰ä¸­ç»„å†…çš„å…ƒç´ ã€‚   
å½“é€‰ä¸­çš„æ˜¯**ç»„å†…**çš„å…ƒç´ æ—¶ï¼Œå³è¯´æ˜æœ€å¤–å±‚çš„ç»„æ˜¯è¢«**é€‰ä¸­**çš„çŠ¶æ€ï¼ŒåŒæ ·éœ€è¦è€ƒè™‘ä¸Šé¢æ‰€è¯´çš„**äº’æ–¥**é—®é¢˜ã€‚   

#### å•å…ƒç´ æ‹–æ‹½ç¼©æ”¾  
å•å…ƒç´ æ“ä½œç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦ç®€å•ä½¿ç”¨`react-rnd`æä¾›çš„åŠŸèƒ½å³å¯å®Œæˆã€‚  
<img src="/images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/single-rnd.gif" />

#### å¤šå…ƒç´ æ‹–æ‹½ç¼©æ”¾  
è¿™é‡Œå°±æ˜¯æœ¬æ–‡çš„é‡ç‚¹äº†ï¼Œç»“åˆå‰é¢ä»‹ç»çš„å‡ ä¸ªä¾èµ–ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„å¤šé€‰æ‹–æ‹½ç¼©æ”¾çš„åŠŸèƒ½ã€‚  

##### å…·ä½“æ€è·¯  
å¤šä¸ªå…ƒç´ æ‹–æ‹½ï¼Œè¯´åˆ°åº•å…¶å®é¼ æ ‡æ‹–æ‹½çš„è¿˜æ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯**é¼ æ ‡æ‹–åŠ¨**çš„é‚£ä¸€ä¸ªå…ƒç´ ã€‚  
è€Œ**å…¶ä½™**è¢«é€‰ä¸­çš„å…ƒç´ ï¼Œä»…ä»…éœ€è¦æ ¹æ®è¢«æ‹–åŠ¨çš„å…ƒç´ çš„å°ºå¯¸ä½ç½®å˜åŠ¨æ¥åšç›¸åº”çš„**åŠ å‡å¤„ç†**å³å¯ã€‚  
##### ç›¸å…³é—®é¢˜  
- ä¿¡æ¯è®¡ç®—   
è”åŠ¨å…ƒç´ çš„ä½ç½®å°ºå¯¸ä¿¡æ¯è¯¥å¦‚ä½•è®¡ç®—ã€‚  
- ç»„ä»¶é—´é€šä¿¡  
å› ä¸ºæ¯ä¸€ä¸ªå›¾è¡¨ç»„ä»¶å¹¶éæ˜¯å•çº¯çš„åŒçº§å…³ç³»ï¼Œå¦‚æœæ˜¯é€šè¿‡å±‚å±‚`props`ä¼ é€’ï¼Œå…ä¸äº†ä¼šæœ‰å¤šä½™çš„åˆ·æ–°ï¼Œé€ æˆ**æ€§èƒ½**é—®é¢˜ã€‚  
è€Œé€šè¿‡å…¨å±€çš„`dva`çŠ¶æ€åŒæ ·åœ¨æ›´æ–°çš„æ—¶å€™ä¼šè®©ç»„ä»¶åˆ·æ–°ã€‚  
- æ•°æ®åˆ·æ–°  
å›¾è¡¨æ•°æ®æ˜¯æ¥è‡ªäº`dva`å…¨å±€çš„æ•°æ®ï¼Œç°åœ¨é¢‘ç¹è‡ªåˆ·æ–°ç›¸å½“äºæ˜¯ä¸€ç›´æ›´æ–°å…¨å±€çš„æ•°æ®ï¼ŒåŒæ ·ä¼šé€ æˆ**æ€§èƒ½**é—®é¢˜ã€‚  
- å…¶ä»–  
ä¸€äº›ç»†èŠ‚é—®é¢˜  

#### è§£å†³æ–¹æ³•
- ä¿¡æ¯è®¡ç®—  
å…³äºä½ç½®çš„è®¡ç®—ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å•çº¯çš„å°†æ“ä½œçš„å…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸å·®å€¼ä¼ é€’ç»™è”åŠ¨ç»„ä»¶å³å¯ã€‚  

- ç»„ä»¶é—´é€šä¿¡  
æ ¹æ®ä¸Šé¢é—®é¢˜çš„è§£æï¼Œå¯ä»¥ä½¿ç”¨`eventemitter3`æ¥å®Œæˆä»»æ„ä½ç½®ã€å±‚çº§çš„æ•°æ®é€šä¿¡ï¼Œå¹¶ä¸”å®ƒå’Œ`react`æ¸²æŸ“æ— ä»»ä½•å…³ç³»ã€‚  
```typescript 
import { useCallback, useEffect } from 'react'
import EventEmitter from 'eventemitter3'

const eventemitter = new EventEmitter()

const SonA = () => {

  console.log('åˆ·æ–°')

  useEffect(() => {
    const listener = (value) => {
      console.log(value)
    }
    eventemitter.addListener('change', listener)
    return () => {
      eventemitter.removeListener('change', listener)
    }
  }, [])

  return (
    <span>son A</span>
  )

}

const SonB = () => {

  const handleClick = useCallback(() => {
    eventemitter.emit('change', 'son B')
  }, [])

  return (
    <span>
      <button onClick={handleClick}>son B</button>
    </span>
  )

}

const Parent = () => {

  return (
    <div>
      <SonA />
      <br />
      <SonB />
    </div>
  )

}

```

è¿è¡Œä¸Šé¢çš„ä¾‹å­å¯ä»¥å‘ç°ï¼Œç‚¹å‡»`SonB`ç»„ä»¶çš„æŒ‰é’®ï¼Œå¯ä»¥è®©`SonA`æ¥æ”¶åˆ°æ¥è‡ªå…¶çš„æ•°æ®ï¼Œå¹¶ä¸”å¹¶æ²¡æœ‰è§¦å‘`SonA`çš„åˆ·æ–°ã€‚  
éœ€è¦**æ¥æ”¶æ•°æ®**çš„ç»„ä»¶åªéœ€è¦ç›‘å¬(`addListener`)æŒ‡å®šçš„äº‹ä»¶å³å¯ï¼Œæ¯”å¦‚ä¸Šé¢çš„`change`äº‹ä»¶ã€‚  
è€Œéœ€è¦**å‘é€æ•°æ®**çš„ç»„ä»¶åˆ™ç›´æ¥å‘å¸ƒ(`emit`)äº‹ä»¶å³å¯ã€‚  
è¿™æ ·å°±é¿å…äº†ä¸€äº›ä¸å¿…è¦çš„åˆ·æ–°ã€‚   
<img src="/images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/eventemitter3.gif" />

- æ•°æ®åˆ·æ–°  
é¢‘ç¹åˆ·æ–°å…¨å±€æ•°æ®ï¼Œä¼šå¯¼è‡´æ‰€æœ‰ä¾èµ–å…¶æ•°æ®çš„ç»„ä»¶éƒ½ä¼šåˆ·æ–°ï¼Œæ‰€ä»¥è€ƒè™‘ä¸ºéœ€è¦åˆ·æ–°æ•°æ®çš„ç»„ä»¶åœ¨å†…éƒ¨å•ç‹¬ç»´æŠ¤ä¸€ä»½çŠ¶æ€ã€‚  
å½“**å¼€å§‹æ“ä½œ**æ—¶ï¼Œè®°å½•ä¸‹çŠ¶æ€ï¼Œæ ‡è¯†å¼€å§‹ä½¿ç”¨**å†…éƒ¨çŠ¶æ€**è¡¨ç¤ºå›¾è¡¨çš„ä¿¡æ¯ï¼Œ**ç»“æŸæ“ä½œ**æ—¶å¤„ç†ä¸‹å†…éƒ¨æ•°æ®çŠ¶æ€ï¼Œå°†æ•°æ®æ›´æ–°åˆ°å…¨å±€ä¸­å»ã€‚  

```typescript 
  import { useMemo, useEffect, useState, useRef } from 'react'
  import EventEmitter from 'eventemitter3'

  const eventemitter = new EventEmitter()

  const Component = (props: {
    position: {left: number, top: number}
  }) => {

    const [ position, setPosition ] = useState({
      left: 0,
      top: 0
    })

    const isDrag = useRef(false)

    const dragStart = () => {
      isDrag.current = true 
      setPosition(props.position)
    }

    const drag = (position) => {
      setPosition(position)
    }

    const dragEnd = () => {
      isDrag.current = false 
      // TODO 
      // æ›´æ–°æ•°æ®åˆ°å…¨å±€
    }

    useEffect(() => {
      eventemitter.addListener('dragStart', dragStart)
      eventemitter.addListener('drag', drag)
      eventemitter.addListener('dragEnd', dragEnd)
      return () => {
        eventemitter.removeListener('dragStart', dragStart)
        eventemitter.removeListener('drag', drag)
        eventemitter.removeListener('dragEnd', dragEnd)
      }
    }, [])

    return (
      <span
        style={{
          left: (isDrag.current ? position : props.position).left,
          top: (isDrag.current ? position : props.position).top
        }}
      >å›¾è¡¨ç»„ä»¶</span>
    )

  }


```

> ä¸Šé¢çš„æ•°æ®æ›´æ–°è¿˜å¯ä»¥æ›´åŠ ä¼˜åŒ–ï¼Œå¯¹äº**çŸ­æ—¶é—´**çš„**å¤šæ¬¡**æ›´æ–°æ“ä½œï¼Œå¯ä»¥æ§åˆ¶ä¸€ä¸‹æ›´æ–°é¢‘ç‡ï¼Œå°†å¤šæ¬¡æ›´æ–°åˆå¹¶ä¸ºä¸€æ¬¡ã€‚  

- å…¶ä»–  
  - æ§åˆ¶åˆ·æ–°  
  è¿™é‡Œçš„æ§åˆ¶åˆ·æ–°æŒ‡çš„æ˜¯ä¸Šè¿°çš„å†…éƒ¨åˆ·æ–°ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å“åº”`react-rnd`å‘å‡ºçš„ç›¸å…³äº‹ä»¶ï¼Œå¯ä»¥åšå¯¹åº”çš„èŠ‚æµ(`throttle`)æ“ä½œï¼Œå‡å°‘äº‹ä»¶è§¦å‘é¢‘ç‡ã€‚  
  - é€šä¿¡å†²çªé—®é¢˜  
  å› ä¸º**æ‰€æœ‰çš„ç»„ä»¶**éƒ½éœ€è¦ç›‘å¬æ‹–æ‹½çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬å½“å‰è¢«æ‹–æ‹½çš„ç»„ä»¶ï¼Œæ‰€ä»¥åœ¨ä¼ é€’ä¿¡æ¯æ—¶ï¼Œéœ€è¦æŠŠè‡ªèº«çš„`id`ç±»ä¼¼å€¼ä¼ é€’ï¼Œé˜²æ­¢å†²çªã€‚  
  - ç»„ä»¶çš„ç¼©æ”¾å±æ€§  
  è¿™é‡Œæ˜¯å…³äºå‰æ–‡è¯´åˆ°çš„**æˆç»„**çš„é€»è¾‘ç›¸å…³ï¼Œå› ä¸ºç»„å­˜åœ¨`scaleX`å’Œ`scaleY`ä¸¤ä¸ªå±æ€§ï¼Œæ‰€ä»¥åœ¨**è°ƒæ•´å¤§å°**çš„æ—¶å€™ï¼Œä¹Ÿè¦å…¼é¡¾æ­¤å±æ€§ï¼ˆæœ¬æ–‡å…ˆæš‚æ—¶ä¸è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼‰ã€‚  
  - å•å…ƒç´ é€‰ä¸­æƒ…å†µ  
  è‡ªå®šä¹‰äº‹ä»¶çš„ç›‘å¬æ˜¯**æ— å·®åˆ«**çš„ï¼Œå½“åªé€‰ä¸­äº†ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ‹–æ‹½ç¼©æ”¾æ“ä½œæ—¶ï¼Œæ— é¡»è§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚  
  
#### æœ€åçš„DEMO  
<img src="/images/æ•°æ®å¯è§†åŒ–å¤§å±è®¾è®¡å™¨å¼€å‘/final-demo.gif" />

```typescript 
import {
  useState,
  useRef,
  useCallback,
  useMemo,
  useEffect
} from 'react'
import { Rnd } from 'react-rnd'
import type { RndResizeCallback, RndDragCallback, RndResizeStartCallback } from 'react-rnd'
import EventEmitter from 'eventemitter3';
import ReactSelecto from 'react-selecto'
import { throttle } from 'lodash'

// å¤§å±ç»„ä»¶çš„æ•°æ®ç±»å‹
type ComponentList = {
  id: string
  width: number
  height: number
  left: number
  top: number
  background: string
}

// åˆ›å»ºäº‹ä»¶
const eventEmitter = new EventEmitter()
const EVENT_MAP = {
  DRAG_START: "DRAG_START",
  DRAG: "DRAG",
  DRAG_STOP: "DRAG_STOP",
  RESIZE_START: "RESIZE_START",
  RESIZE: "RESIZE",
  RESIZE_STOP: "RESIZE_STOP"
}

const getComponentStyle = (position: any, size: any) => {
  const newWidth = parseInt(size.style.width) || 20;
  const newHeight = parseInt(size.style.height) || 20;
  return {
    width: newWidth,
    height: newHeight,
    left: position.x,
    top: position.y,
  };
};

// è¿™é‡Œç”¨åˆ°çš„ dataset æ˜¯htmlåŸç”Ÿdata-çš„å±æ€§  
// ç”¨äºæ ‡è¯†ç»„ä»¶
const Selecto = (props: {
  setSelect: (value: string[]) => void;
  select: string[]
}) => {
  const { setSelect, select } = props;

  // è¿™é‡Œå†…éƒ¨æ§åˆ¶ä¸€ä¸ªçŠ¶æ€
  // æ˜¯å› ä¸ºä¸æƒ³é¢‘ç¹åˆ·æ–°é€‰ä¸­çš„çŠ¶æ€ 
  // å…¶å®ä¹Ÿæ²¡æœ‰å¿…è¦
  // æœ€åæ‹–æ‹½å®Œæˆå†æ›´æ”¹é€‰ä¸­çŠ¶æ€å°±å¯ä»¥äº† 
  const currentSelect = useRef<string[]>([]);

  // æ‹–æ‹½å®Œæˆæ›´æ”¹çŠ¶æ€
  const handleSelectEnd = useCallback(() => {
    setSelect(currentSelect.current);
  }, [setSelect]);

  // æ‹–æ‹½ä¸­  
  const handleSelect = useCallback((e: any) => {
    const { added, removed } = e;

    const toAddList = added.reduce((acc: any, element: any) => {
      const select = element.dataset.id;
      acc.push(select)
      return acc;
    }, []);
    const toRemoveList = removed.map((element: any) => element.dataset.id);

    const newSelect = [
      ...currentSelect.current.filter((item) => !toRemoveList.includes(item)),
      ...toAddList,
    ];
    currentSelect.current = newSelect;
  }, []);

  const handleDragStart = useCallback(
    (e: any) => {
      try {
        // ç»„ä»¶id
        const componentId = e.inputEvent.target.dataset?.id;
        // ç»„ä»¶ç¼©æ”¾çš„è¾¹æ¡†  
        // ä¸æ’é™¤ä»–çš„è¯æ— æ³•ç¼©æ”¾
        const componentBorder =
          e.inputEvent.target.className.includes('react-select-to-border');
        // å¯ä»¥åœ¨è¿™é‡Œæ‰©å±•æ›´å¤šçš„åˆ¤æ–­
        // å› ä¸ºæ ¹æ®å‰é¢ä»‹ç»å¯èƒ½ä¼šä»ç»„å†…å…ƒç´  æˆ–è€… å¤–å±‚ä¸åŒçš„å…ƒç´ å¼€å§‹æ‹–æ‹½  
        // å¯èƒ½ä¼šå­˜åœ¨å†²çª  

        if (!select.includes(componentId) && !componentBorder) {
          setSelect?.([]);
        } else {
          e.stop();
        }
      } catch (err) {
        e.stop();
      }
    },
    [setSelect, select],
  );

  return (
    <ReactSelecto
      dragContainer={'#container'}
      selectableTargets={['.react-select-to']}
      hitRate={10}
      toggleContinueSelect={'shift'}
      selectByClick
      selectFromInside
      ratio={0}
      onDragStart={handleDragStart}
      onSelectEnd={handleSelectEnd}
      onSelect={handleSelect}
    ></ReactSelecto>
  );
};

const Component = (props: ComponentList & {
  isSelect: boolean
  isMultiSelect: boolean
  onChange: (value: Partial<ComponentList> & { id: string }) => void
}) => {

  const {
    isSelect,
    background,
    left,
    top,
    width,
    height,
    id,
    onChange,
    isMultiSelect
  } = props;

  // å†…éƒ¨çš„ä½ç½®ä¿¡æ¯
  const [statePosition, setStatePosition] = useState({
    x: left,
    y: top
  });
  // å†…éƒ¨çš„å°ºå¯¸ä¿¡æ¯
  const [stateSize, setStateSize] = useState({
    width,
    height
  })
  // æ˜¯å¦å¤„äºæ‹–æ‹½ä¸­
  const [isDealing, setIsDealing] = useState<boolean>(false)

  // æ‹–æ‹½ä¸­çš„ç»„ä»¶çš„ä¿¡æ¯
  // ä½¿ç”¨refæ˜¯ä¸ºäº†åˆ·æ–°
  const dragInfo = useRef({
    left: statePosition?.x || 0,
    top: statePosition?.y || 0,
    drag: false,
  });
  // ç¼©æ”¾çš„ç»„ä»¶ä¿¡æ¯
  const resizeInfo = useRef({
    left: statePosition?.x || 0,
    top: statePosition?.y || 0,
    width: stateSize?.width || 0,
    height: stateSize?.height || 0,
    resize: false,
  });

  // æ ¹æ®æ˜¯å¦æ“ä½œçš„çŠ¶æ€ä½¿ç”¨ä¸åŒçš„çŠ¶æ€ä¿¡æ¯
  // ä½ç½®
  const position = useMemo(() => {
    if (isDealing) {
      return statePosition;
    }
    return {
      x: left,
      y: top
    };
  }, [left, top, statePosition, isDealing]);

  // æ ¹æ®æ˜¯å¦æ“ä½œçš„çŠ¶æ€ä½¿ç”¨ä¸åŒçš„çŠ¶æ€ä¿¡æ¯
  // å°ºå¯¸
  const size = useMemo(() => {
    if (isDealing) return stateSize;
    return {
      width,
      height
    };
  }, [width, height, stateSize, isDealing]);

  // è°ƒæ•´å¤§å°æ–¹æ³•
  const resizeMethod: any = (
    e: any,
    direction: any,
    ref: any,
    delta: any,
    position: any,
    isSelf: boolean,
    value: ComponentList,
    outerResizeInfo: any,
  ) => {
    // è·å–åˆ°ä¹‹å‰çš„ä½ç½®ä¿¡æ¯
    const resizePositionX = (outerResizeInfo || resizeInfo.current).left;
    const resizePositionY = (outerResizeInfo || resizeInfo.current).top;

    let newWidth = 0;
    let newHeight = 0;
    // delta 
    let realDeltaX =
      typeof resizePositionX === 'number' ? position.x - resizePositionX : 0;
    let realDeltaY =
      typeof resizePositionY === 'number' ? position.y - resizePositionY : 0;

    // è·å–å½“å‰çš„çŠ¶æ€ä¿¡æ¯
    const newStyle = getComponentStyle(position, ref);
    let defaultChangeConfig: Partial<ComponentList> = {};

    // é¼ æ ‡æ“ä½œç»„ä»¶
    if (isSelf) {
      const { width, height } = newStyle;
      newWidth = width;
      newHeight = height;
      defaultChangeConfig = {
        ...newStyle
      };
    } 
    // ä¸æ˜¯é¼ æ ‡æ“ä½œç»„ä»¶
    else {
      const { width, height, left, top } = value;
      let realDeltaWidth = outerResizeInfo
        ? newStyle.width - outerResizeInfo.width
        : 0;
      let realDeltaHeight = outerResizeInfo
        ? newStyle.height - outerResizeInfo.height
        : 0;

      newWidth = width + realDeltaWidth;
      newHeight = height + realDeltaHeight;
      defaultChangeConfig = {
        width: newWidth,
        height: newHeight,
        left: left + realDeltaX,
        top: top + realDeltaY,
      };
    }

    // ä¸è€ƒè™‘åµŒå¥—ç»„
    if (true) return defaultChangeConfig
    // TODO 
    // å¯ä»¥ç»§ç»­åœ¨ä¸‹é¢å¤„ç†æ“ä½œç»„çš„é€»è¾‘
  };

  // æ‹–æ‹½æ–¹æ³•
  const dragMethod: any = (
    event: any,
    data: any,
    isSelf: boolean,
    value: any,
    outerDragInfo: any,
  ) => {
    const { x, y, deltaX, deltaY } = data;

    const left = x;
    const top = y;

    // é¼ æ ‡æ“ä½œç»„ä»¶
    if (isSelf) {
      return {
        left,
        top,
      };
    }

    // ä¸æ˜¯é¼ æ ‡æ“ä½œç»„ä»¶åˆ™ä½¿ç”¨deltaæ¥è¿›è¡Œè®¡ç®—
    return {
      left: value.left + deltaX,
      top: value.top + deltaY,
    };
  };

  // å¤šç»„ä»¶å¤åˆè°ƒæ•´å¤§å°
  const multiOnResize: RndResizeCallback = (
    e,
    direction,
    ref,
    delta,
    position,
  ) => {
    const newStyle = getComponentStyle(position, ref);

    resizeInfo.current.resize = true;

    // è§¦å‘äº‹ä»¶
    eventEmitter.emit(
      EVENT_MAP.RESIZE,
      id,
      e,
      direction,
      ref,
      delta,
      position,
      resizeInfo.current,
    );

    // æ›´æ–°è‡ªèº«çš„çŠ¶æ€
    resizeInfo.current = {
      ...resizeInfo.current,
      ...newStyle,
    };
  };

  // å¤åˆæ‹–æ‹½
  const multiOnDrag: RndDragCallback = (event, data) => {
    const { x, y } = data;

    dragInfo.current.drag = true;

    // è®¡ç®—deltaç»™å…¶ä»–è”åŠ¨ç»„ä»¶ä½¿ç”¨
    const deltaX = x - dragInfo.current.left;
    const deltaY = y - dragInfo.current.top;

    // è§¦å‘äº‹ä»¶
    eventEmitter.emit(
      EVENT_MAP.DRAG,
      id,
      event,
      {
        ...data,
        deltaX,
        deltaY,
      },
      dragInfo.current,
    );

    // æ›´æ–°è‡ªèº«çŠ¶æ€
    dragInfo.current = {
      ...dragInfo.current,
      left: x,
      top: y,
    };
  };

  // realtionå¼€å¤´çš„éƒ½æ˜¯ç›‘å¬
  // é¼ æ ‡æ“ä½œçš„ç›®æ ‡ç»„ä»¶å‘å‡ºçš„è‡ªå®šä¹‰äº‹ä»¶
  const onRelationDragStart = (targetId: string) => {
    if (!isSelect || id === targetId) return;
    setIsDealing(true);
  };

  const onRelationDrag = (
    targetId: string,
    event: any,
    data: any,
    outerDragInfo: any,
  ) => {
    if (!isSelect || id === targetId) return;
    const nextPosition = dragMethod(
      event,
      data,
      false,
      {
        left: dragInfo.current.left || 0,
        top: dragInfo.current.top || 0,
      },
      outerDragInfo,
    );
    const nextState = {
      x: nextPosition.left || 0,
      y: nextPosition.top || 0,
    };
    dragInfo.current = {
      ...dragInfo.current,
      ...nextPosition,
    };
    setStatePosition((prev) => ({ ...nextState }));
  };

  const onRelationDragStop = (
    targetId: string,
    event: any,
    data: any,
    outerDragInfo: any,
  ) => {
    if (!isSelect || id === targetId) return;
    setIsDealing(false);
    const nextPosition = dragMethod(
      event,
      data,
      false,
      {
        left: dragInfo.current.left || 0,
        top: dragInfo.current.top || 0,
      },
      outerDragInfo,
    );
    dragInfo.current = {
      ...dragInfo.current,
      ...nextPosition,
    };

    const { left, top } = dragInfo.current;
    onChange({
      id,
      left,
      top
    })
  };

  const onRelationResizeStart = (targetId: string, direction: any) => {
    if (!isSelect || id === targetId) return;
    setIsDealing(true);
  };

  const onRelationResize = (
    targetId: string,
    e: any,
    direction: any,
    ref: any,
    delta: any,
    position: any,
    outerResizeInfo: any,
  ) => {
    if (!isSelect || id === targetId) return;

    const nextConfig = resizeMethod(
      e,
      direction,
      ref,
      delta,
      position,
      false,
      {
        left: resizeInfo.current.left || 0,
        top: resizeInfo.current.top || 0,
        width: resizeInfo.current.width || 0,
        height: resizeInfo.current.height || 0,
      },
      outerResizeInfo,
    );

    const { left, top, width, height } = nextConfig;
    resizeInfo.current = {
      ...resizeInfo.current,
      left,
      top,
      width,
      height
    };

    setStatePosition((prev) => ({
      x: resizeInfo.current.left,
      y: resizeInfo.current.top
    }));
    setStateSize((prev) => ({
      width: resizeInfo.current.width,
      height: resizeInfo.current.height
    }));
  };

  const onRelationResizeStop = (
    targetId: string,
    e: any,
    direction: any,
    ref: any,
    delta: any,
    position: any,
    outerResizeInfo: any,
  ) => {
    if (!isSelect || id === targetId) return;

    setIsDealing(false);
    const nextConfig = resizeMethod(
      e,
      direction,
      ref,
      delta,
      position,
      false,
      {
        left: resizeInfo.current.left || 0,
        top: resizeInfo.current.top || 0,
        width: resizeInfo.current.width || 0,
        height: resizeInfo.current.height || 0,
      },
      outerResizeInfo,
    );

    const { left, top, width, height } = nextConfig;
    resizeInfo.current = {
      ...resizeInfo.current,
      left,
      top,
      width,
      height
    };

    const { left: x, top: y, width: currentWidth, height: currentHeight } = resizeInfo.current;

    onChange({
      id,
      left: x || 0,
      top: y || 0,
      width: (currentWidth as number) || 20,
      height: (currentHeight as number) || 20,
    })
  };

  const multiResizeStart: RndResizeStartCallback = (_, direction) => {
    eventEmitter.emit(
      EVENT_MAP.RESIZE_START,
      id,
      direction,
    );
    resizeInfo.current.resize = true;
  }

  const _onDrag: RndDragCallback = (event: any, data: any) => {
    // * å¤åˆç§»åŠ¨
    if (isMultiSelect) {
      multiOnDrag(event, data);
    }
  };

  // èŠ‚æµå¸®åŠ©å‡å°‘é¢‘ç¹çš„æ›´æ–°
  // å› ä¸ºæ¯ä¸€æ¬¡éƒ½æ›´æ–°æ—¶æ²¡æœ‰å¿…è¦çš„
  const multiDrag = throttle(_onDrag, 100);

  const _onResize: RndResizeCallback = (...args) => {
    // * å¤åˆå°ºå¯¸ä¿®æ”¹
    if (isMultiSelect) {
      multiOnResize(...args);
    }
  };

  const multiResize = throttle(_onResize, 100);

  const multiDragStop: RndDragCallback = (event, data) => {
    const { x, y } = data;
    if (isMultiSelect) {
      const deltaX = x - dragInfo.current.left;
      const deltaY = y - dragInfo.current.top;

      eventEmitter.emit(
        EVENT_MAP.DRAG_STOP,
        id,
        event,
        {
          ...data,
          deltaX,
          deltaY,
        },
        dragInfo.current,
      );

      dragInfo.current = {
        ...dragInfo.current,
        left: x,
        top: y,
      };
    }
    dragInfo.current.drag = false;
  };

  const multiResizeStop: RndResizeCallback = (
    e,
    direction,
    ref,
    delta,
    position,
  ) => {
    const newStyle = getComponentStyle(position, ref);

    resizeInfo.current.resize = true;

    eventEmitter.emit(
      EVENT_MAP.RESIZE_STOP,
      id,
      e,
      direction,
      ref,
      delta,
      position,
      resizeInfo.current,
    );

    resizeInfo.current.resize = false;

    resizeInfo.current = {
      ...resizeInfo.current,
      ...newStyle,
    };
  };

  const multiDragStart: RndDragCallback = () => {
    eventEmitter.emit(
      EVENT_MAP.DRAG_START,
      id,
    );
    dragInfo.current.drag = true;
  }

  const onDragStart: RndDragCallback = (...args) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;
    multiDragStart(...args)
  }

  const onDrag: RndDragCallback = (...args) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;
    multiDrag(...args)
  };

  const onResize: RndResizeCallback = (...args) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;
    multiResize(...args)
  }

  const onDragStop: RndDragCallback = (event, data) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;
    onChange({
      ...dragMethod(event, data, true),
      id
    })

    multiDragStop(event, data);
  };

  const onResizeStart: RndResizeStartCallback = (...args) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;
    multiResizeStart(...args)
  }

  const onResizeStop: RndResizeCallback = (
    e,
    direction,
    ref,
    delta,
    position,
  ) => {
    // * æœªé€‰ä¸­ä¸è§¦å‘äº‹ä»¶
    if (!isSelect) return;

    onChange({
      ...resizeMethod(e, direction, ref, delta, position, true),
      id
    })

    multiResizeStop(e, direction, ref, delta, position)
  };

  // ç»‘å®šæ‹–æ‹½å’Œç¼©æ”¾çš„äº‹ä»¶
  // ç”¨äºå¤šé€‰ç»„ä»¶é—´é€šä¿¡
  useEffect(() => {
    if(isSelect) {
      eventEmitter.addListener(
        EVENT_MAP.DRAG_START,
        onRelationDragStart,
      );
      eventEmitter.addListener(
        EVENT_MAP.DRAG,
        onRelationDrag,
      );
      eventEmitter.addListener(
        EVENT_MAP.DRAG_STOP,
        onRelationDragStop,
      );
      eventEmitter.addListener(
        EVENT_MAP.RESIZE_START,
        onRelationResizeStart,
      );
      eventEmitter.addListener(
        EVENT_MAP.RESIZE,
        onRelationResize,
      );
      eventEmitter.addListener(
        EVENT_MAP.RESIZE_STOP,
        onRelationResizeStop,
      );
    }
    return () => {
      eventEmitter.removeListener(
        EVENT_MAP.DRAG_START,
        onRelationDragStart,
      );
      eventEmitter.removeListener(
        EVENT_MAP.DRAG,
        onRelationDrag,
      );
      eventEmitter.removeListener(
        EVENT_MAP.DRAG_STOP,
        onRelationDragStop,
      );
      eventEmitter.removeListener(
        EVENT_MAP.RESIZE_START,
        onRelationResizeStart,
      );
      eventEmitter.removeListener(
        EVENT_MAP.RESIZE,
        onRelationResize,
      );
      eventEmitter.removeListener(
        EVENT_MAP.RESIZE_STOP,
        onRelationResizeStop,
      );
    };
  }, [isSelect]);

  // å…¨å±€ç»„ä»¶çš„å°ºå¯¸ä¿¡æ¯çŠ¶æ€æ›´æ–°æ—¶
  // åŒæ­¥åˆ°ç»„ä»¶å†…éƒ¨
  useEffect(() => {
    setStatePosition({
      x: left,
      y: top
    });
    resizeInfo.current = {
      ...resizeInfo.current,
      left: left ?? resizeInfo.current.left,
      top: top ?? resizeInfo.current.top,
    };
    dragInfo.current = {
      ...dragInfo.current,
      left: left ?? dragInfo.current.left,
      top: top ?? dragInfo.current.top,
    };
  }, [left, top]);

  // å…¨å±€ç»„ä»¶çš„å®½é«˜ä¿¡æ¯çŠ¶æ€æ›´æ–°æ—¶
  // åŒæ­¥åˆ°ç»„ä»¶å†…éƒ¨
  useEffect(() => {
    setStateSize({
      width,
      height
    });
    resizeInfo.current = {
      ...resizeInfo.current,
      width: width ?? resizeInfo.current.width,
      height: height ?? resizeInfo.current.height,
    };
  }, [width, height]);

  return (
    <Rnd
      style={{
        border: `1px solid ${isSelect ? 'black' : 'transparent'}`
      }}
      enableResizing={isSelect}
      disableDragging={!isSelect}
      default={{
        x: 0,
        y: 0,
        width: 320,
        height: 200,
      }}
      onDragStart={onDragStart}
      onDrag={onDrag}
      onDragStop={onDragStop}
      onResizeStart={onResizeStart}
      onResize={onResize}
      onResizeStop={onResizeStop}
      minWidth={20}
      minHeight={20}
      position={position}
      size={size}
      // è®¾ç½®ç¼©æ”¾è¾¹æ¡†çš„class
      // ä¸è®¾ç½®çš„è¯ä¼šå¯¼è‡´ä¸ç¼©æ”¾å†²çª 
      resizeHandleClasses={[
        'left',
        'top',
        'right',
        'bottom',
        'topLeft',
        'topRight',
        'bottomLeft',
        'bottomRight',
      ].reduce<any>((acc, cur) => {
        acc[cur] = 'react-select-to-border';
        return acc;
      }, {})}
    >
      <div
        style={{
          backgroundColor: background,
          width: '100%',
          height: '100%'
        }}
        // ç”¨äºSelectoç»„ä»¶ä¸­çš„ç»„ä»¶æ ‡è¯†
        data-id={id}
        // å’ŒSelectoç»„ä»¶ä¸­çš„selectableTargetså¯¹åº”
        className="react-select-to"
      >

      </div>
    </Rnd>
  )

}

const Parent = () => {

  const [componentList, setComponentList] = useState<ComponentList[]>([
    {
      id: '1',
      background: 'red',
      left: 20,
      top: 30,
      width: 200,
      height: 100
    },
    {
      id: '2',
      background: 'green',
      left: 200,
      top: 300,
      width: 100,
      height: 100
    },
    {
      id: '3',
      background: 'gray',
      left: 250,
      top: 50,
      width: 50,
      height: 50
    },
    {
      id: '4',
      background: 'blue',
      left: 250,
      top: 100,
      width: 100,
      height: 100
    },
    {
      id: '5',
      background: 'pink',
      left: 400,
      top: 150,
      width: 100,
      height: 100
    },
    {
      id: '6',
      background: 'yellow',
      left: 400,
      top: 300,
      width: 100,
      height: 100
    }
  ])
  const [select, setSelect] = useState<string[]>([])

  // æ›´æ–°ç»„ä»¶ä¿¡æ¯
  const onComponentChange = useCallback((value: Partial<ComponentList> & { id: string }) => {
    const { id } = value
    setComponentList(prev => {
      return prev.map(item => {
        if (item.id !== id) return item
        return {
          ...item,
          ...value
        }
      })
    })
  }, [])

  return (
    // å’ŒSelectoç»„ä»¶ä¸­çš„containerå¯¹åº”
    <div
      id="container"
      style={{
        width: '100vw',
        height: '100vh'
      }}
    >
      <Selecto
        select={select}
        setSelect={setSelect}
      />
      {
        componentList.map(component => {
          return (
            <Component
              key={component.id}
              {...component}
              isSelect={select.includes(component.id)}
              onChange={onComponentChange}
              isMultiSelect={select.length > 1}
            />
          )
        })
      }
    </div>
  )

}

export default Parent
```

## æˆå“  
å…¶å®åœ¨ä¹‹å‰å°±å·²ç»å‘ç°å…¶å®`react-selecto`çš„ä½œè€…ä¹Ÿæœ‰ç ”å‘å…¶ä»–çš„å¯è§†åŒ–æ“ä½œæ¨¡å—ï¼ŒåŒ…æ‹¬æœ¬æ–‡æ‰€è¯´çš„å¤šé€‰æ‹–æ‹½çš„æ“ä½œï¼Œä½†æ˜¯å¥ˆä½•æ— æ³•æ»¡è¶³æœ¬é¡¹ç›®çš„éœ€æ±‚ï¼Œæ•…è‡ªå·±å®ç°äº†åŠŸèƒ½ã€‚  
å¦‚æœæœ‰å…´è¶£å¯ä»¥å»çœ‹ä¸€ä¸‹è¿™ä¸ªæˆå“[moveable](https://daybrush.com/moveable/)ã€‚  
## æ€»ç»“  

é€šè¿‡ä¸Šé¢çš„æ€è·¯ï¼Œå³å¯å®Œæˆä¸€ä¸ªç®€å•çš„å¤šå…ƒç´ æ‹–æ‹½ç¼©æ”¾çš„åŠŸèƒ½ï¼Œå…¶æ ¸å¿ƒå…¶å®å°±æ˜¯`eventemitter3`çš„è‡ªå®šä¹‰äº‹ä»¶åŠŸèƒ½ï¼Œå®ƒçš„ç”¨é€”åœ¨å¹³å¸¸çš„ä¸šåŠ¡ä¸­éå¸¸å¹¿æ³›ã€‚  
æ¯”å¦‚æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨ä»¥ä¸Šä¾‹å­çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šå…ƒç´ æ‹–æ‹½æ—¶**å¸é™„**çš„åŠŸèƒ½ã€‚    

## ç»“æŸ  

  ç»“æŸğŸ”šã€‚  

  é¡ºä¾¿åœ¨ä¸‹é¢é™„ä¸Šç›¸å…³çš„é“¾æ¥ã€‚  
> [è¯•ç”¨åœ°å€](http://47.97.27.23/api/backend/screen/index.html)  
[è¯•ç”¨è´¦å·](https://github.com/food-billboard/create-chart/issues/2)  
[æ“ä½œæ–‡æ¡£](http://47.97.27.23/api/backend/create-chart-docs/index.html)  
[ä»£ç åœ°å€](https://github.com/food-billboard/create-chart)       